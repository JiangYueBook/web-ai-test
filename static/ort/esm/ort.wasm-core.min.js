/*!
 * ONNX Runtime Web v1.17.0
 * Copyright (c) Microsoft Corporation. All rights reserved.
 * Licensed under the MIT License.
 */
var ct=Object.defineProperty;var _n=Object.getOwnPropertyDescriptor;var Bn=Object.getOwnPropertyNames;var Cn=Object.prototype.hasOwnProperty;var M=(o,n)=>()=>(o&&(n=o(o=0)),n);var Dn=(o,n)=>()=>(n||o((n={exports:{}}).exports,n),n.exports),Ge=(o,n)=>{for(var r in n)ct(o,r,{get:n[r],enumerable:!0})},Mn=(o,n,r,u)=>{if(n&&typeof n=="object"||typeof n=="function")for(let s of Bn(n))!Cn.call(o,s)&&s!==r&&ct(o,s,{get:()=>n[s],enumerable:!(u=_n(n,s))||u.enumerable});return o};var dt=o=>Mn(ct({},"__esModule",{value:!0}),o);var Ye,ge,we,Ve,Xe=M(()=>{"use strict";Ye=new Map,ge=[],we=(o,n,r)=>{if(n&&typeof n.init=="function"&&typeof n.createInferenceSessionHandler=="function"){let u=Ye.get(o);if(u===void 0)Ye.set(o,{backend:n,priority:r});else{if(u.priority>r)return;if(u.priority===r&&u.backend!==n)throw new Error(`cannot register backend "${o}" using priority ${r}`)}if(r>=0){let s=ge.indexOf(o);s!==-1&&ge.splice(s,1);for(let m=0;m<ge.length;m++)if(Ye.get(ge[m]).priority<=r){ge.splice(m,0,o);return}ge.push(o)}return}throw new TypeError("not a valid backend")},Ve=async o=>{let n=o.length===0?ge:o,r=[];for(let u of n){let s=Ye.get(u);if(s){if(s.initialized)return s.backend;if(s.aborted)continue;let m=!!s.initPromise;try{return m||(s.initPromise=s.backend.init()),await s.initPromise,s.initialized=!0,s.backend}catch(f){m||r.push({name:u,err:f}),s.aborted=!0}finally{delete s.initPromise}}}throw new Error(`no available backend found. ERR: ${r.map(u=>`[${u.name}] ${u.err}`).join(", ")}`)}});var Zt=M(()=>{"use strict";Xe()});var Kt,Qt=M(()=>{"use strict";Kt="1.17.0"});var er,pt,tr=M(()=>{"use strict";Qt();er="warning",pt={wasm:{},webgl:{},webgpu:{},versions:{common:Kt},set logLevel(o){if(o!==void 0){if(typeof o!="string"||["verbose","info","warning","error","fatal"].indexOf(o)===-1)throw new Error(`Unsupported logging level: ${o}`);er=o}},get logLevel(){return er}};Object.defineProperty(pt,"logLevel",{enumerable:!0})});var $,rr=M(()=>{"use strict";tr();$=pt});var nr,or,ir=M(()=>{"use strict";nr=(o,n)=>{let r=document.createElement("canvas");r.width=o.dims[3],r.height=o.dims[2];let u=r.getContext("2d");if(u!=null){let s,m;n?.tensorLayout!==void 0&&n.tensorLayout==="NHWC"?(s=o.dims[2],m=o.dims[3]):(s=o.dims[3],m=o.dims[2]);let f=n?.format!==void 0?n.format:"RGB",p=n?.norm,h,c;p===void 0||p.mean===void 0?h=[255,255,255,255]:typeof p.mean=="number"?h=[p.mean,p.mean,p.mean,p.mean]:(h=[p.mean[0],p.mean[1],p.mean[2],0],p.mean[3]!==void 0&&(h[3]=p.mean[3])),p===void 0||p.bias===void 0?c=[0,0,0,0]:typeof p.bias=="number"?c=[p.bias,p.bias,p.bias,p.bias]:(c=[p.bias[0],p.bias[1],p.bias[2],0],p.bias[3]!==void 0&&(c[3]=p.bias[3]));let y=m*s,b=0,w=y,E=y*2,x=-1;f==="RGBA"?(b=0,w=y,E=y*2,x=y*3):f==="RGB"?(b=0,w=y,E=y*2):f==="RBG"&&(b=0,E=y,w=y*2);for(let O=0;O<m;O++)for(let _=0;_<s;_++){let U=(o.data[b++]-c[0])*h[0],W=(o.data[w++]-c[1])*h[1],V=(o.data[E++]-c[2])*h[2],j=x===-1?255:(o.data[x++]-c[3])*h[3];u.fillStyle="rgba("+U+","+W+","+V+","+j+")",u.fillRect(_,O,1,1)}return r.toDataURL()}else throw new Error("Can not access image data")},or=(o,n)=>{let r=document.createElement("canvas").getContext("2d"),u;if(r!=null){let s,m,f;n?.tensorLayout!==void 0&&n.tensorLayout==="NHWC"?(s=o.dims[2],m=o.dims[1],f=o.dims[3]):(s=o.dims[3],m=o.dims[2],f=o.dims[1]);let p=n!==void 0&&n.format!==void 0?n.format:"RGB",h=n?.norm,c,y;h===void 0||h.mean===void 0?c=[255,255,255,255]:typeof h.mean=="number"?c=[h.mean,h.mean,h.mean,h.mean]:(c=[h.mean[0],h.mean[1],h.mean[2],255],h.mean[3]!==void 0&&(c[3]=h.mean[3])),h===void 0||h.bias===void 0?y=[0,0,0,0]:typeof h.bias=="number"?y=[h.bias,h.bias,h.bias,h.bias]:(y=[h.bias[0],h.bias[1],h.bias[2],0],h.bias[3]!==void 0&&(y[3]=h.bias[3]));let b=m*s;if(n!==void 0&&(n.format!==void 0&&f===4&&n.format!=="RGBA"||f===3&&n.format!=="RGB"&&n.format!=="BGR"))throw new Error("Tensor format doesn't match input tensor dims");let w=4,E=0,x=1,O=2,_=3,U=0,W=b,V=b*2,j=-1;p==="RGBA"?(U=0,W=b,V=b*2,j=b*3):p==="RGB"?(U=0,W=b,V=b*2):p==="RBG"&&(U=0,V=b,W=b*2),u=r.createImageData(s,m);for(let L=0;L<m*s;E+=w,x+=w,O+=w,_+=w,L++)u.data[E]=(o.data[U++]-y[0])*c[0],u.data[x]=(o.data[W++]-y[1])*c[1],u.data[O]=(o.data[V++]-y[2])*c[2],u.data[_]=j===-1?255:(o.data[j++]-y[3])*c[3]}else throw new Error("Can not access image data");return u}});var mt,ar,sr,ur,fr,lr=M(()=>{"use strict";qe();mt=(o,n)=>{if(o===void 0)throw new Error("Image buffer must be defined");if(n.height===void 0||n.width===void 0)throw new Error("Image height and width must be defined");if(n.tensorLayout==="NHWC")throw new Error("NHWC Tensor layout is not supported yet");let{height:r,width:u}=n,s=n.norm??{mean:255,bias:0},m,f;typeof s.mean=="number"?m=[s.mean,s.mean,s.mean,s.mean]:m=[s.mean[0],s.mean[1],s.mean[2],s.mean[3]??255],typeof s.bias=="number"?f=[s.bias,s.bias,s.bias,s.bias]:f=[s.bias[0],s.bias[1],s.bias[2],s.bias[3]??0];let p=n.format!==void 0?n.format:"RGBA",h=n.tensorFormat!==void 0&&n.tensorFormat!==void 0?n.tensorFormat:"RGB",c=r*u,y=h==="RGBA"?new Float32Array(c*4):new Float32Array(c*3),b=4,w=0,E=1,x=2,O=3,_=0,U=c,W=c*2,V=-1;p==="RGB"&&(b=3,w=0,E=1,x=2,O=-1),h==="RGBA"?V=c*3:h==="RBG"?(_=0,W=c,U=c*2):h==="BGR"&&(W=0,U=c,_=c*2);for(let L=0;L<c;L++,w+=b,x+=b,E+=b,O+=b)y[_++]=(o[w]+f[0])/m[0],y[U++]=(o[E]+f[1])/m[1],y[W++]=(o[x]+f[2])/m[2],V!==-1&&O!==-1&&(y[V++]=(o[O]+f[3])/m[3]);return h==="RGBA"?new J("float32",y,[1,4,r,u]):new J("float32",y,[1,3,r,u])},ar=async(o,n)=>{let r=typeof HTMLImageElement<"u"&&o instanceof HTMLImageElement,u=typeof ImageData<"u"&&o instanceof ImageData,s=typeof ImageBitmap<"u"&&o instanceof ImageBitmap,m=typeof o=="string",f,p=n??{};if(r){let h=document.createElement("canvas");h.width=o.width,h.height=o.height;let c=h.getContext("2d");if(c!=null){let y=o.height,b=o.width;if(n!==void 0&&n.resizedHeight!==void 0&&n.resizedWidth!==void 0&&(y=n.resizedHeight,b=n.resizedWidth),n!==void 0){if(p=n,n.tensorFormat!==void 0)throw new Error("Image input config format must be RGBA for HTMLImageElement");p.tensorFormat="RGBA",p.height=y,p.width=b}else p.tensorFormat="RGBA",p.height=y,p.width=b;c.drawImage(o,0,0),f=c.getImageData(0,0,b,y).data}else throw new Error("Can not access image data")}else if(u){let h,c;if(n!==void 0&&n.resizedWidth!==void 0&&n.resizedHeight!==void 0?(h=n.resizedHeight,c=n.resizedWidth):(h=o.height,c=o.width),n!==void 0&&(p=n),p.format="RGBA",p.height=h,p.width=c,n!==void 0){let y=document.createElement("canvas");y.width=c,y.height=h;let b=y.getContext("2d");if(b!=null)b.putImageData(o,0,0),f=b.getImageData(0,0,c,h).data;else throw new Error("Can not access image data")}else f=o.data}else if(s){if(n===void 0)throw new Error("Please provide image config with format for Imagebitmap");let h=document.createElement("canvas");h.width=o.width,h.height=o.height;let c=h.getContext("2d");if(c!=null){let y=o.height,b=o.width;return c.drawImage(o,0,0,b,y),f=c.getImageData(0,0,b,y).data,p.height=y,p.width=b,mt(f,p)}else throw new Error("Can not access image data")}else{if(m)return new Promise((h,c)=>{let y=document.createElement("canvas"),b=y.getContext("2d");if(!o||!b)return c();let w=new Image;w.crossOrigin="Anonymous",w.src=o,w.onload=()=>{y.width=w.width,y.height=w.height,b.drawImage(w,0,0,y.width,y.height);let E=b.getImageData(0,0,y.width,y.height);p.height=y.height,p.width=y.width,h(mt(E.data,p))}});throw new Error("Input data provided is not supported - aborted tensor creation")}if(f!==void 0)return mt(f,p);throw new Error("Input data provided is not supported - aborted tensor creation")},sr=(o,n)=>{let{width:r,height:u,download:s,dispose:m}=n,f=[1,u,r,4];return new J({location:"texture",type:"float32",texture:o,dims:f,download:s,dispose:m})},ur=(o,n)=>{let{dataType:r,dims:u,download:s,dispose:m}=n;return new J({location:"gpu-buffer",type:r??"float32",gpuBuffer:o,dims:u,download:s,dispose:m})},fr=(o,n,r)=>new J({location:"cpu-pinned",type:o,data:n,dims:r??[n.length]})});var Ie,Je,cr,dr,pr=M(()=>{"use strict";Ie=new Map([["float32",Float32Array],["uint8",Uint8Array],["int8",Int8Array],["uint16",Uint16Array],["float16",Uint16Array],["int16",Int16Array],["int32",Int32Array],["bool",Uint8Array],["float64",Float64Array],["uint32",Uint32Array]]),Je=new Map([[Float32Array,"float32"],[Uint8Array,"uint8"],[Int8Array,"int8"],[Uint16Array,"uint16"],[Int16Array,"int16"],[Int32Array,"int32"],[Float64Array,"float64"],[Uint32Array,"uint32"]]),cr=!1,dr=()=>{if(!cr){cr=!0;let o=typeof BigInt64Array<"u"&&typeof BigInt64Array.from=="function",n=typeof BigUint64Array<"u"&&typeof BigUint64Array.from=="function";o&&(Ie.set("int64",BigInt64Array),Je.set(BigInt64Array,"int64")),n&&(Ie.set("uint64",BigUint64Array),Je.set(BigUint64Array,"uint64"))}}});var mr,hr,yr=M(()=>{"use strict";qe();mr=o=>{let n=1;for(let r=0;r<o.length;r++){let u=o[r];if(typeof u!="number"||!Number.isSafeInteger(u))throw new TypeError(`dims[${r}] must be an integer, got: ${u}`);if(u<0)throw new RangeError(`dims[${r}] must be a non-negative integer, got: ${u}`);n*=u}return n},hr=(o,n)=>{switch(o.location){case"cpu":return new J(o.type,o.data,n);case"cpu-pinned":return new J({location:"cpu-pinned",data:o.data,type:o.type,dims:n});case"texture":return new J({location:"texture",texture:o.texture,type:o.type,dims:n});case"gpu-buffer":return new J({location:"gpu-buffer",gpuBuffer:o.gpuBuffer,type:o.type,dims:n});default:throw new Error(`tensorReshape: tensor location ${o.location} is not supported`)}}});var J,qe=M(()=>{"use strict";ir();lr();pr();yr();J=class{constructor(n,r,u){dr();let s,m;if(typeof n=="object"&&"location"in n)switch(this.dataLocation=n.location,s=n.type,m=n.dims,n.location){case"cpu-pinned":{let p=Ie.get(s);if(!p)throw new TypeError(`unsupported type "${s}" to create tensor from pinned buffer`);if(!(n.data instanceof p))throw new TypeError(`buffer should be of type ${p.name}`);this.cpuData=n.data;break}case"texture":{if(s!=="float32")throw new TypeError(`unsupported type "${s}" to create tensor from texture`);this.gpuTextureData=n.texture,this.downloader=n.download,this.disposer=n.dispose;break}case"gpu-buffer":{if(s!=="float32"&&s!=="float16"&&s!=="int32"&&s!=="int64"&&s!=="uint32"&&s!=="bool")throw new TypeError(`unsupported type "${s}" to create tensor from gpu buffer`);this.gpuBufferData=n.gpuBuffer,this.downloader=n.download,this.disposer=n.dispose;break}default:throw new Error(`Tensor constructor: unsupported location '${this.dataLocation}'`)}else{let p,h;if(typeof n=="string")if(s=n,h=u,n==="string"){if(!Array.isArray(r))throw new TypeError("A string tensor's data must be a string array.");p=r}else{let c=Ie.get(n);if(c===void 0)throw new TypeError(`Unsupported tensor type: ${n}.`);if(Array.isArray(r)){if(n==="float16")throw new TypeError("Creating a float16 tensor from number array is not supported. Please use Uint16Array as data.");n==="uint64"||n==="int64"?p=c.from(r,BigInt):p=c.from(r)}else if(r instanceof c)p=r;else throw new TypeError(`A ${s} tensor's data must be type of ${c}`)}else if(h=r,Array.isArray(n)){if(n.length===0)throw new TypeError("Tensor type cannot be inferred from an empty array.");let c=typeof n[0];if(c==="string")s="string",p=n;else if(c==="boolean")s="bool",p=Uint8Array.from(n);else throw new TypeError(`Invalid element type of data array: ${c}.`)}else{let c=Je.get(n.constructor);if(c===void 0)throw new TypeError(`Unsupported type for tensor data: ${n.constructor}.`);s=c,p=n}if(h===void 0)h=[p.length];else if(!Array.isArray(h))throw new TypeError("A tensor's dims must be a number array");m=h,this.cpuData=p,this.dataLocation="cpu"}let f=mr(m);if(this.cpuData&&f!==this.cpuData.length)throw new Error(`Tensor's size(${f}) does not match data length(${this.cpuData.length}).`);this.type=s,this.dims=m,this.size=f}static async fromImage(n,r){return ar(n,r)}static fromTexture(n,r){return sr(n,r)}static fromGpuBuffer(n,r){return ur(n,r)}static fromPinnedBuffer(n,r,u){return fr(n,r,u)}toDataURL(n){return nr(this,n)}toImageData(n){return or(this,n)}get data(){if(this.ensureValid(),!this.cpuData)throw new Error("The data is not on CPU. Use `getData()` to download GPU data to CPU, or use `texture` or `gpuBuffer` property to access the GPU data directly.");return this.cpuData}get location(){return this.dataLocation}get texture(){if(this.ensureValid(),!this.gpuTextureData)throw new Error("The data is not stored as a WebGL texture.");return this.gpuTextureData}get gpuBuffer(){if(this.ensureValid(),!this.gpuBufferData)throw new Error("The data is not stored as a WebGPU buffer.");return this.gpuBufferData}async getData(n){switch(this.ensureValid(),this.dataLocation){case"cpu":case"cpu-pinned":return this.data;case"texture":case"gpu-buffer":{if(!this.downloader)throw new Error("The current tensor is not created with a specified data downloader.");if(this.isDownloading)throw new Error("The current tensor is being downloaded.");try{this.isDownloading=!0;let r=await this.downloader();return this.downloader=void 0,this.dataLocation="cpu",this.cpuData=r,n&&this.disposer&&(this.disposer(),this.disposer=void 0),r}finally{this.isDownloading=!1}}default:throw new Error(`cannot get data from location: ${this.dataLocation}`)}}dispose(){if(this.isDownloading)throw new Error("The current tensor is being downloaded.");this.disposer&&(this.disposer(),this.disposer=void 0),this.cpuData=void 0,this.gpuTextureData=void 0,this.gpuBufferData=void 0,this.downloader=void 0,this.isDownloading=void 0,this.dataLocation="none"}ensureValid(){if(this.dataLocation==="none")throw new Error("The tensor is disposed.")}reshape(n){if(this.ensureValid(),this.downloader||this.disposer)throw new Error("Cannot reshape a tensor that owns GPU resource.");return hr(this,n)}}});var Y,Ze=M(()=>{"use strict";qe();Y=J});var Ke,gr=M(()=>{"use strict";Xe();Ze();Ke=class o{constructor(n){this.handler=n}async run(n,r,u){let s={},m={};if(typeof n!="object"||n===null||n instanceof Y||Array.isArray(n))throw new TypeError("'feeds' must be an object that use input names as keys and OnnxValue as corresponding values.");let f=!0;if(typeof r=="object"){if(r===null)throw new TypeError("Unexpected argument[1]: cannot be null.");if(r instanceof Y)throw new TypeError("'fetches' cannot be a Tensor");if(Array.isArray(r)){if(r.length===0)throw new TypeError("'fetches' cannot be an empty array.");f=!1;for(let c of r){if(typeof c!="string")throw new TypeError("'fetches' must be a string array or an object.");if(this.outputNames.indexOf(c)===-1)throw new RangeError(`'fetches' contains invalid output name: ${c}.`);s[c]=null}if(typeof u=="object"&&u!==null)m=u;else if(typeof u<"u")throw new TypeError("'options' must be an object.")}else{let c=!1,y=Object.getOwnPropertyNames(r);for(let b of this.outputNames)if(y.indexOf(b)!==-1){let w=r[b];(w===null||w instanceof Y)&&(c=!0,f=!1,s[b]=w)}if(c){if(typeof u=="object"&&u!==null)m=u;else if(typeof u<"u")throw new TypeError("'options' must be an object.")}else m=r}}else if(typeof r<"u")throw new TypeError("Unexpected argument[1]: must be 'fetches' or 'options'.");for(let c of this.inputNames)if(typeof n[c]>"u")throw new Error(`input '${c}' is missing in 'feeds'.`);if(f)for(let c of this.outputNames)s[c]=null;let p=await this.handler.run(n,s,m),h={};for(let c in p)if(Object.hasOwnProperty.call(p,c)){let y=p[c];y instanceof Y?h[c]=y:h[c]=new Y(y.type,y.data,y.dims)}return h}async release(){return this.handler.dispose()}static async create(n,r,u,s){let m,f={};if(typeof n=="string"){if(m=n,typeof r=="object"&&r!==null)f=r;else if(typeof r<"u")throw new TypeError("'options' must be an object.")}else if(n instanceof Uint8Array){if(m=n,typeof r=="object"&&r!==null)f=r;else if(typeof r<"u")throw new TypeError("'options' must be an object.")}else if(n instanceof ArrayBuffer||typeof SharedArrayBuffer<"u"&&n instanceof SharedArrayBuffer){let b=n,w=0,E=n.byteLength;if(typeof r=="object"&&r!==null)f=r;else if(typeof r=="number"){if(w=r,!Number.isSafeInteger(w))throw new RangeError("'byteOffset' must be an integer.");if(w<0||w>=b.byteLength)throw new RangeError(`'byteOffset' is out of range [0, ${b.byteLength}).`);if(E=n.byteLength-w,typeof u=="number"){if(E=u,!Number.isSafeInteger(E))throw new RangeError("'byteLength' must be an integer.");if(E<=0||w+E>b.byteLength)throw new RangeError(`'byteLength' is out of range (0, ${b.byteLength-w}].`);if(typeof s=="object"&&s!==null)f=s;else if(typeof s<"u")throw new TypeError("'options' must be an object.")}else if(typeof u<"u")throw new TypeError("'byteLength' must be a number.")}else if(typeof r<"u")throw new TypeError("'options' must be an object.");m=new Uint8Array(b,w,E)}else throw new TypeError("Unexpected argument[0]: must be 'path' or 'buffer'.");let h=(f.executionProviders||[]).map(b=>typeof b=="string"?b:b.name),y=await(await Ve(h)).createInferenceSessionHandler(m,f);return new o(y)}startProfiling(){this.handler.startProfiling()}endProfiling(){this.handler.endProfiling()}get inputNames(){return this.handler.inputNames}get outputNames(){return this.handler.outputNames}}});var Un,wr=M(()=>{"use strict";gr();Un=Ke});var br=M(()=>{"use strict"});var Ln,Qe,vr=M(()=>{"use strict";Xe();Ze();Ln="Training backend could not be resolved. Make sure you're using the correct configuration & WebAssembly files.",Qe=class o{constructor(n,r,u){this.handler=n,this.hasOptimizerModel=r,this.hasEvalModel=u}get trainingInputNames(){return this.handler.inputNames}get trainingOutputNames(){return this.handler.outputNames}get evalInputNames(){if(this.hasEvalModel)return this.handler.evalInputNames;throw new Error("This training session has no evalModel loaded.")}get evalOutputNames(){if(this.hasEvalModel)return this.handler.evalOutputNames;throw new Error("This training session has no evalModel loaded.")}static async create(n,r){let u=n.evalModel||"",s=n.optimizerModel||"",m=r||{},p=(m.executionProviders||[]).map(c=>typeof c=="string"?c:c.name),h=await Ve(p);if(h.createTrainingSessionHandler){let c=await h.createTrainingSessionHandler(n.checkpointState,n.trainModel,u,s,m);return new o(c,!!n.optimizerModel,!!n.evalModel)}else throw new Error(Ln)}typeNarrowingForRunStep(n,r,u,s,m){let f={},p={};if(typeof u!="object"||u===null||u instanceof Y||Array.isArray(u))throw new TypeError("'feeds' must be an object that use input names as keys and OnnxValue as corresponding values.");let h=!0;if(typeof s=="object"){if(s===null)throw new TypeError("Unexpected argument[1]: cannot be null.");if(s instanceof Y)throw new TypeError("'fetches' cannot be a Tensor");if(Array.isArray(s)){if(s.length===0)throw new TypeError("'fetches' cannot be an empty array.");h=!1;for(let c of s){if(typeof c!="string")throw new TypeError("'fetches' must be a string array or an object.");if(r.indexOf(c)===-1)throw new RangeError(`'fetches' contains invalid output name: ${c}.`);f[c]=null}if(typeof m=="object"&&m!==null)p=m;else if(typeof m<"u")throw new TypeError("'options' must be an object.")}else{let c=!1,y=Object.getOwnPropertyNames(s);for(let b of r)if(y.indexOf(b)!==-1){let w=s[b];(w===null||w instanceof Y)&&(c=!0,h=!1,f[b]=w)}if(c){if(typeof m=="object"&&m!==null)p=m;else if(typeof m<"u")throw new TypeError("'options' must be an object.")}else p=s}}else if(typeof s<"u")throw new TypeError("Unexpected argument[1]: must be 'fetches' or 'options'.");for(let c of n)if(typeof u[c]>"u")throw new Error(`input '${c}' is missing in 'feeds'.`);if(h)for(let c of r)f[c]=null;return[f,p]}convertHandlerReturnTypeToMapOfTensors(n){let r={};for(let u in n)if(Object.hasOwnProperty.call(n,u)){let s=n[u];s instanceof Y?r[u]=s:r[u]=new Y(s.type,s.data,s.dims)}return r}async lazyResetGrad(){await this.handler.lazyResetGrad()}async runTrainStep(n,r,u){let[s,m]=this.typeNarrowingForRunStep(this.trainingInputNames,this.trainingOutputNames,n,r,u),f=await this.handler.runTrainStep(n,s,m);return this.convertHandlerReturnTypeToMapOfTensors(f)}async runOptimizerStep(n){if(this.hasOptimizerModel)await this.handler.runOptimizerStep(n||{});else throw new Error("This TrainingSession has no OptimizerModel loaded.")}async runEvalStep(n,r,u){if(this.hasEvalModel){let[s,m]=this.typeNarrowingForRunStep(this.evalInputNames,this.evalOutputNames,n,r,u),f=await this.handler.runEvalStep(n,s,m);return this.convertHandlerReturnTypeToMapOfTensors(f)}else throw new Error("This TrainingSession has no EvalModel loaded.")}async getParametersSize(n=!0){return this.handler.getParametersSize(n)}async loadParametersBuffer(n,r=!0){let u=await this.getParametersSize(r);if(n.length!==4*u)throw new Error("Size of the buffer passed into loadParametersBuffer must match the number of parameters in the model. Please use getParametersSize method to check.");return this.handler.loadParametersBuffer(n,r)}async getContiguousParameters(n=!0){return this.handler.getContiguousParameters(n)}async release(){return this.handler.dispose()}}});var Rn,Er=M(()=>{"use strict";vr();Rn=Qe});var ht={};Ge(ht,{InferenceSession:()=>Un,Tensor:()=>Y,TrainingSession:()=>Rn,env:()=>$,registerBackend:()=>we});var be=M(()=>{"use strict";Zt();rr();wr();Ze();br();Er()});var Sr={};Ge(Sr,{readFile:()=>kn});var kn,Or=M(()=>{kn=void 0});var Ar={};Ge(Ar,{join:()=>Fn});var Fn,Pr=M(()=>{Fn=void 0});var _r=Dn((xr,yt)=>{"use strict";var Ir=(()=>{var o=typeof document<"u"&&document.currentScript?document.currentScript.src:void 0;return typeof __filename<"u"&&(o=o||__filename),function(n={}){var r=n,u,s;r.ready=new Promise((e,t)=>{u=e,s=t});var m=Object.assign({},r),f="./this.program",p=typeof window=="object",h=typeof importScripts=="function",c=typeof process=="object"&&typeof process.versions=="object"&&typeof process.versions.node=="string",y="",b,w,E;if(c){var x=(Or(),dt(Sr)),O=(Pr(),dt(Ar));y=h?O.dirname(y)+"/":__dirname+"/",b=(e,t)=>(e=e.startsWith("file://")?new URL(e):O.normalize(e),x.readFileSync(e,t?void 0:"utf8")),E=e=>(e=b(e,!0),e.buffer||(e=new Uint8Array(e)),e),w=(e,t,i,a=!0)=>{e=e.startsWith("file://")?new URL(e):O.normalize(e),x.readFile(e,a?void 0:"utf8",(l,g)=>{l?i(l):t(a?g.buffer:g)})},!r.thisProgram&&1<process.argv.length&&(f=process.argv[1].replace(/\\/g,"/")),process.argv.slice(2),r.inspect=()=>"[Emscripten Module object]"}else(p||h)&&(h?y=self.location.href:typeof document<"u"&&document.currentScript&&(y=document.currentScript.src),o&&(y=o),y.indexOf("blob:")!==0?y=y.substr(0,y.replace(/[?#].*/,"").lastIndexOf("/")+1):y="",b=e=>{var t=new XMLHttpRequest;return t.open("GET",e,!1),t.send(null),t.responseText},h&&(E=e=>{var t=new XMLHttpRequest;return t.open("GET",e,!1),t.responseType="arraybuffer",t.send(null),new Uint8Array(t.response)}),w=(e,t,i)=>{var a=new XMLHttpRequest;a.open("GET",e,!0),a.responseType="arraybuffer",a.onload=()=>{a.status==200||a.status==0&&a.response?t(a.response):i()},a.onerror=i,a.send(null)});var _=console.log.bind(console),U=console.error.bind(console);Object.assign(r,m),m=null,typeof WebAssembly!="object"&&De("no native wasm support detected");var W,V=!1,j,L,oe,pe,T,B,Be,Ce,Se,ue;function C(){var e=W.buffer;r.HEAP8=j=new Int8Array(e),r.HEAP16=oe=new Int16Array(e),r.HEAPU8=L=new Uint8Array(e),r.HEAPU16=pe=new Uint16Array(e),r.HEAP32=T=new Int32Array(e),r.HEAPU32=B=new Uint32Array(e),r.HEAPF32=Be=new Float32Array(e),r.HEAPF64=ue=new Float64Array(e),r.HEAP64=Ce=new BigInt64Array(e),r.HEAPU64=Se=new BigUint64Array(e)}var fe=[],ve=[],re=[],ne=0,H=null,X=null;function De(e){throw e="Aborted("+e+")",U(e),V=!0,e=new WebAssembly.RuntimeError(e+". Build with -sASSERTIONS for more info."),s(e),e}function me(e){return e.startsWith("data:application/octet-stream;base64,")}var le;if(le="ort-wasm.wasm",!me(le)){var Oe=le;le=r.locateFile?r.locateFile(Oe,y):y+Oe}function Me(e){if(E)return E(e);throw"both async and sync fetching of the wasm failed"}function he(e){if(p||h){if(typeof fetch=="function"&&!e.startsWith("file://"))return fetch(e,{credentials:"same-origin"}).then(t=>{if(!t.ok)throw"failed to load wasm binary file at '"+e+"'";return t.arrayBuffer()}).catch(()=>Me(e));if(w)return new Promise((t,i)=>{w(e,a=>t(new Uint8Array(a)),i)})}return Promise.resolve().then(()=>Me(e))}function ce(e,t,i){return he(e).then(a=>WebAssembly.instantiate(a,t)).then(a=>a).then(i,a=>{U(`failed to asynchronously prepare wasm: ${a}`),De(a)})}function Ue(e,t){var i=le;return typeof WebAssembly.instantiateStreaming!="function"||me(i)||i.startsWith("file://")||c||typeof fetch!="function"?ce(i,e,t):fetch(i,{credentials:"same-origin"}).then(a=>WebAssembly.instantiateStreaming(a,e).then(t,function(l){return U(`wasm streaming compile failed: ${l}`),U("falling back to ArrayBuffer instantiation"),ce(i,e,t)}))}function q(e){this.Va=e-24,this.fb=function(t){B[this.Va+4>>>2>>>0]=t},this.eb=function(t){B[this.Va+8>>>2>>>0]=t},this.Za=function(t,i){this.$a(),this.fb(t),this.eb(i)},this.$a=function(){B[this.Va+16>>>2>>>0]=0}}var G=0,Ae=0,Pe=typeof TextDecoder<"u"?new TextDecoder("utf8"):void 0,Le=(e,t,i)=>{t>>>=0;var a=t+i;for(i=t;e[i]&&!(i>=a);)++i;if(16<i-t&&e.buffer&&Pe)return Pe.decode(e.subarray(t,i));for(a="";t<i;){var l=e[t++];if(l&128){var g=e[t++]&63;if((l&224)==192)a+=String.fromCharCode((l&31)<<6|g);else{var S=e[t++]&63;l=(l&240)==224?(l&15)<<12|g<<6|S:(l&7)<<18|g<<12|S<<6|e[t++]&63,65536>l?a+=String.fromCharCode(l):(l-=65536,a+=String.fromCharCode(55296|l>>10,56320|l&1023))}}else a+=String.fromCharCode(l)}return a},Re=(e,t)=>(e>>>=0)?Le(L,e,t):"",ke=e=>{for(var t=0,i=0;i<e.length;++i){var a=e.charCodeAt(i);127>=a?t++:2047>=a?t+=2:55296<=a&&57343>=a?(t+=4,++i):t+=3}return t},Fe=(e,t,i,a)=>{if(i>>>=0,!(0<a))return 0;var l=i;a=i+a-1;for(var g=0;g<e.length;++g){var S=e.charCodeAt(g);if(55296<=S&&57343>=S){var v=e.charCodeAt(++g);S=65536+((S&1023)<<10)|v&1023}if(127>=S){if(i>=a)break;t[i++>>>0]=S}else{if(2047>=S){if(i+1>=a)break;t[i++>>>0]=192|S>>6}else{if(65535>=S){if(i+2>=a)break;t[i++>>>0]=224|S>>12}else{if(i+3>=a)break;t[i++>>>0]=240|S>>18,t[i++>>>0]=128|S>>12&63}t[i++>>>0]=128|S>>6&63}t[i++>>>0]=128|S&63}}return t[i>>>0]=0,i-l},It=e=>{if(e===null)return"null";var t=typeof e;return t==="object"||t==="array"||t==="function"?e.toString():""+e},xt,te=e=>{for(var t="";L[e>>>0];)t+=xt[L[e++>>>0]];return t},at={},st={},fn={},de;function ln(e,t,i={}){var a=t.name;if(!e)throw new de(`type "${a}" must have a positive integer typeid pointer`);if(st.hasOwnProperty(e)){if(i.gb)return;throw new de(`Cannot register type '${a}' twice`)}st[e]=t,delete fn[e],at.hasOwnProperty(e)&&(t=at[e],delete at[e],t.forEach(l=>l()))}function ie(e,t,i={}){if(!("argPackAdvance"in t))throw new TypeError("registerType registeredInstance requires argPackAdvance");ln(e,t,i)}var _t=(e,t,i)=>{switch(t){case 1:return i?a=>j[a>>>0>>>0]:a=>L[a>>>0>>>0];case 2:return i?a=>oe[a>>>1>>>0]:a=>pe[a>>>1>>>0];case 4:return i?a=>T[a>>>2>>>0]:a=>B[a>>>2>>>0];case 8:return i?a=>Ce[a>>>3]:a=>Se[a>>>3];default:throw new TypeError(`invalid integer width (${t}): ${e}`)}};function Bt(){this.Sa=[void 0],this.bb=[]}var Q=new Bt;function ut(e){e>>>=0,e>=Q.Va&&--Q.get(e).cb===0&&Q.$a(e)}var Z=e=>{if(!e)throw new de("Cannot use deleted val. handle = "+e);return Q.get(e).value},ee=e=>{switch(e){case void 0:return 1;case null:return 2;case!0:return 3;case!1:return 4;default:return Q.Za({cb:1,value:e})}};function Ct(e){return this.fromWireType(T[e>>>2>>>0])}var cn=(e,t)=>{switch(t){case 4:return function(i){return this.fromWireType(Be[i>>>2>>>0])};case 8:return function(i){return this.fromWireType(ue[i>>>3>>>0])};default:throw new TypeError(`invalid float width (${t}): ${e}`)}};function dn(e){return this.fromWireType(B[e>>>2>>>0])}var Dt=typeof TextDecoder<"u"?new TextDecoder("utf-16le"):void 0,pn=(e,t)=>{for(var i=e>>1,a=i+t/2;!(i>=a)&&pe[i>>>0];)++i;if(i<<=1,32<i-e&&Dt)return Dt.decode(L.subarray(e>>>0,i>>>0));for(i="",a=0;!(a>=t/2);++a){var l=oe[e+2*a>>>1>>>0];if(l==0)break;i+=String.fromCharCode(l)}return i},mn=(e,t,i)=>{if(i===void 0&&(i=2147483647),2>i)return 0;i-=2;var a=t;i=i<2*e.length?i/2:e.length;for(var l=0;l<i;++l)oe[t>>>1>>>0]=e.charCodeAt(l),t+=2;return oe[t>>>1>>>0]=0,t-a},hn=e=>2*e.length,yn=(e,t)=>{for(var i=0,a="";!(i>=t/4);){var l=T[e+4*i>>>2>>>0];if(l==0)break;++i,65536<=l?(l-=65536,a+=String.fromCharCode(55296|l>>10,56320|l&1023)):a+=String.fromCharCode(l)}return a},gn=(e,t,i)=>{if(t>>>=0,i===void 0&&(i=2147483647),4>i)return 0;var a=t;i=a+i-4;for(var l=0;l<e.length;++l){var g=e.charCodeAt(l);if(55296<=g&&57343>=g){var S=e.charCodeAt(++l);g=65536+((g&1023)<<10)|S&1023}if(T[t>>>2>>>0]=g,t+=4,t+4>i)break}return T[t>>>2>>>0]=0,t-a},wn=e=>{for(var t=0,i=0;i<e.length;++i){var a=e.charCodeAt(i);55296<=a&&57343>=a&&++i,t+=4}return t},We=(e,t)=>{var i=st[e];if(i===void 0)throw e=Gt(e),i=te(e),ae(e),new de(t+" has unknown type "+i);return i},bn={},ze=e=>{var t=bn[e];return t===void 0?te(e):t},Ne=[],Mt=()=>typeof globalThis=="object"?globalThis:Function("return this")(),vn=e=>{var t=Ne.length;return Ne.push(e),t},En=(e,t)=>{for(var i=Array(e),a=0;a<e;++a)i[a]=We(B[t+4*a>>>2>>>0],"parameter "+a);return i},Ut=e=>{if(e===void 0)return"_unknown";e=e.replace(/[^a-zA-Z0-9_]/g,"$");var t=e.charCodeAt(0);return 48<=t&&57>=t?`_${e}`:e},Lt={};function Tn(e,t){return e=Ut(e),{[e]:function(){return t.apply(this,arguments)}}[e]}function Sn(e){var t=Function;if(!(t instanceof Function))throw new TypeError(`new_ called with constructor type ${typeof t} which is not a function`);var i=Tn(t.name||"unknownFunctionName",function(){});return i.prototype=t.prototype,i=new i,e=t.apply(i,e),e instanceof Object?e:i}var On=e=>{for(var t="",i=0;i<e;++i)t+=(i!==0?", ":"")+"arg"+i;var a="return function emval_allocator_"+e+`(constructor, argTypes, args) {
  var HEAPU32 = getMemory();
`;for(i=0;i<e;++i)a+="var argType"+i+" = requireRegisteredType(HEAPU32[((argTypes)>>>2)], 'parameter "+i+`');
var arg`+i+" = argType"+i+`.readValueFromPointer(args);
args += argType`+i+`['argPackAdvance'];
argTypes += 4;
`;return new Function("requireRegisteredType","Module","valueToHandle","getMemory",a+("var obj = new constructor("+t+`);
return valueToHandle(obj);
}
`))(We,r,ee,()=>B)},Rt={},Ee=e=>e%4===0&&(e%100!==0||e%400===0),kt=[0,31,60,91,121,152,182,213,244,274,305,335],Ft=[0,31,59,90,120,151,181,212,243,273,304,334],Wt=e=>{var t=ke(e)+1,i=je(t);return i&&Fe(e,L,i,t),i},ft={},zt=()=>{if(!lt){var e={USER:"web_user",LOGNAME:"web_user",PATH:"/",PWD:"/",HOME:"/home/web_user",LANG:(typeof navigator=="object"&&navigator.languages&&navigator.languages[0]||"C").replace("-","_")+".UTF-8",_:f||"./this.program"},t;for(t in ft)ft[t]===void 0?delete e[t]:e[t]=ft[t];var i=[];for(t in e)i.push(`${t}=${e[t]}`);lt=i}return lt},lt,An=[null,[],[]],Nt=[31,29,31,30,31,30,31,31,30,31,30,31],$t=[31,28,31,30,31,30,31,31,30,31,30,31];function Pn(e){var t=Array(ke(e)+1);return Fe(e,t,0,t.length),t}function jt(e,t,i,a){function l(d,D,k){for(d=typeof d=="number"?d.toString():d||"";d.length<D;)d=k[0]+d;return d}function g(d,D){return l(d,D,"0")}function S(d,D){function k(Jt){return 0>Jt?-1:0<Jt?1:0}var ye;return(ye=k(d.getFullYear()-D.getFullYear()))===0&&(ye=k(d.getMonth()-D.getMonth()))===0&&(ye=k(d.getDate()-D.getDate())),ye}function v(d){switch(d.getDay()){case 0:return new Date(d.getFullYear()-1,11,29);case 1:return d;case 2:return new Date(d.getFullYear(),0,3);case 3:return new Date(d.getFullYear(),0,2);case 4:return new Date(d.getFullYear(),0,1);case 5:return new Date(d.getFullYear()-1,11,31);case 6:return new Date(d.getFullYear()-1,11,30)}}function A(d){var D=d.Ta;for(d=new Date(new Date(d.Ua+1900,0,1).getTime());0<D;){var k=d.getMonth(),ye=(Ee(d.getFullYear())?Nt:$t)[k];if(D>ye-d.getDate())D-=ye-d.getDate()+1,d.setDate(1),11>k?d.setMonth(k+1):(d.setMonth(0),d.setFullYear(d.getFullYear()+1));else{d.setDate(d.getDate()+D);break}}return k=new Date(d.getFullYear()+1,0,4),D=v(new Date(d.getFullYear(),0,4)),k=v(k),0>=S(D,d)?0>=S(k,d)?d.getFullYear()+1:d.getFullYear():d.getFullYear()-1}e>>>=0,t>>>=0,i>>>=0,a>>>=0;var I=B[a+40>>>2>>>0];a={kb:T[a>>>2>>>0],jb:T[a+4>>>2>>>0],Xa:T[a+8>>>2>>>0],ab:T[a+12>>>2>>>0],Ya:T[a+16>>>2>>>0],Ua:T[a+20>>>2>>>0],Oa:T[a+24>>>2>>>0],Ta:T[a+28>>>2>>>0],mb:T[a+32>>>2>>>0],ib:T[a+36>>>2>>>0],lb:I?Re(I):""},i=Re(i),I={"%c":"%a %b %d %H:%M:%S %Y","%D":"%m/%d/%y","%F":"%Y-%m-%d","%h":"%b","%r":"%I:%M:%S %p","%R":"%H:%M","%T":"%H:%M:%S","%x":"%m/%d/%y","%X":"%H:%M:%S","%Ec":"%c","%EC":"%C","%Ex":"%m/%d/%y","%EX":"%H:%M:%S","%Ey":"%y","%EY":"%Y","%Od":"%d","%Oe":"%e","%OH":"%H","%OI":"%I","%Om":"%m","%OM":"%M","%OS":"%S","%Ou":"%u","%OU":"%U","%OV":"%V","%Ow":"%w","%OW":"%W","%Oy":"%y"};for(var R in I)i=i.replace(new RegExp(R,"g"),I[R]);var K="Sunday Monday Tuesday Wednesday Thursday Friday Saturday".split(" "),se="January February March April May June July August September October November December".split(" ");I={"%a":d=>K[d.Oa].substring(0,3),"%A":d=>K[d.Oa],"%b":d=>se[d.Ya].substring(0,3),"%B":d=>se[d.Ya],"%C":d=>g((d.Ua+1900)/100|0,2),"%d":d=>g(d.ab,2),"%e":d=>l(d.ab,2," "),"%g":d=>A(d).toString().substring(2),"%G":d=>A(d),"%H":d=>g(d.Xa,2),"%I":d=>(d=d.Xa,d==0?d=12:12<d&&(d-=12),g(d,2)),"%j":d=>{for(var D=0,k=0;k<=d.Ya-1;D+=(Ee(d.Ua+1900)?Nt:$t)[k++]);return g(d.ab+D,3)},"%m":d=>g(d.Ya+1,2),"%M":d=>g(d.jb,2),"%n":()=>`
`,"%p":d=>0<=d.Xa&&12>d.Xa?"AM":"PM","%S":d=>g(d.kb,2),"%t":()=>"	","%u":d=>d.Oa||7,"%U":d=>g(Math.floor((d.Ta+7-d.Oa)/7),2),"%V":d=>{var D=Math.floor((d.Ta+7-(d.Oa+6)%7)/7);if(2>=(d.Oa+371-d.Ta-2)%7&&D++,D)D==53&&(k=(d.Oa+371-d.Ta)%7,k==4||k==3&&Ee(d.Ua)||(D=1));else{D=52;var k=(d.Oa+7-d.Ta-1)%7;(k==4||k==5&&Ee(d.Ua%400-1))&&D++}return g(D,2)},"%w":d=>d.Oa,"%W":d=>g(Math.floor((d.Ta+7-(d.Oa+6)%7)/7),2),"%y":d=>(d.Ua+1900).toString().substring(2),"%Y":d=>d.Ua+1900,"%z":d=>{d=d.ib;var D=0<=d;return d=Math.abs(d)/60,(D?"+":"-")+("0000"+(d/60*100+d%60)).slice(-4)},"%Z":d=>d.lb,"%%":()=>"%"},i=i.replace(/%%/g,"\0\0");for(R in I)i.includes(R)&&(i=i.replace(new RegExp(R,"g"),I[R](a)));return i=i.replace(/\0\0/g,"%"),R=Pn(i),R.length>t?0:(j.set(R,e>>>0),R.length-1)}for(var Ht=Array(256),$e=0;256>$e;++$e)Ht[$e]=String.fromCharCode($e);xt=Ht,de=r.BindingError=class extends Error{constructor(e){super(e),this.name="BindingError"}},r.InternalError=class extends Error{constructor(e){super(e),this.name="InternalError"}},Object.assign(Bt.prototype,{get(e){return this.Sa[e]},has(e){return this.Sa[e]!==void 0},Za(e){var t=this.bb.pop()||this.Sa.length;return this.Sa[t]=e,t},$a(e){this.Sa[e]=void 0,this.bb.push(e)}}),Q.Sa.push({value:void 0},{value:null},{value:!0},{value:!1}),Q.Va=Q.Sa.length,r.count_emval_handles=()=>{for(var e=0,t=Q.Va;t<Q.Sa.length;++t)Q.Sa[t]!==void 0&&++e;return e};var In={a:function(e,t,i){throw e>>>=0,new q(e).Za(t>>>0,i>>>0),G=e,Ae++,G},v:function(){return 0},ba:function(){},N:function(){},P:function(){},H:function(){return 0},$:function(){},V:function(){},_:function(){},A:function(){},O:function(){},L:function(){},aa:function(){},M:function(){},D:function(e,t,i,a,l){t>>>=0,t=te(t);var g=t.indexOf("u")!=-1;g&&(l=(1n<<64n)-1n),ie(e>>>0,{name:t,fromWireType:S=>S,toWireType:function(S,v){if(typeof v!="bigint"&&typeof v!="number")throw new TypeError(`Cannot convert "${It(v)}" to ${this.name}`);if(v<a||v>l)throw new TypeError(`Passing a number "${It(v)}" from JS side to C/C++ side to an argument of type "${t}", which is outside the valid range [${a}, ${l}]!`);return v},argPackAdvance:8,readValueFromPointer:_t(t,i>>>0,!g),Wa:null})},ea:function(e,t,i,a){t=te(t>>>0),ie(e>>>0,{name:t,fromWireType:function(l){return!!l},toWireType:function(l,g){return g?i:a},argPackAdvance:8,readValueFromPointer:function(l){return this.fromWireType(L[l>>>0])},Wa:null})},da:function(e,t){t=te(t>>>0),ie(e>>>0,{name:t,fromWireType:i=>{var a=Z(i);return ut(i),a},toWireType:(i,a)=>ee(a),argPackAdvance:8,readValueFromPointer:Ct,Wa:null})},C:function(e,t,i){t=te(t>>>0),ie(e>>>0,{name:t,fromWireType:a=>a,toWireType:(a,l)=>l,argPackAdvance:8,readValueFromPointer:cn(t,i>>>0),Wa:null})},p:function(e,t,i,a,l){if(e>>>=0,i>>>=0,t=te(t>>>0),l===-1&&(l=4294967295),l=v=>v,a===0){var g=32-8*i;l=v=>v<<g>>>g}var S=t.includes("unsigned")?function(v,A){return A>>>0}:function(v,A){return A};ie(e,{name:t,fromWireType:l,toWireType:S,argPackAdvance:8,readValueFromPointer:_t(t,i,a!==0),Wa:null})},l:function(e,t,i){function a(g){return new l(j.buffer,B[g+4>>>2>>>0],B[g>>>2>>>0])}var l=[Int8Array,Uint8Array,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array,BigInt64Array,BigUint64Array][t];i=te(i>>>0),ie(e>>>0,{name:i,fromWireType:a,argPackAdvance:8,readValueFromPointer:a},{gb:!0})},E:function(e,t){t=te(t>>>0);var i=t==="std::string";ie(e>>>0,{name:t,fromWireType:function(a){var l=B[a>>>2>>>0],g=a+4;if(i)for(var S=g,v=0;v<=l;++v){var A=g+v;if(v==l||L[A>>>0]==0){if(S=Re(S,A-S),I===void 0)var I=S;else I+=String.fromCharCode(0),I+=S;S=A+1}}else{for(I=Array(l),v=0;v<l;++v)I[v]=String.fromCharCode(L[g+v>>>0]);I=I.join("")}return ae(a),I},toWireType:function(a,l){l instanceof ArrayBuffer&&(l=new Uint8Array(l));var g=typeof l=="string";if(!(g||l instanceof Uint8Array||l instanceof Uint8ClampedArray||l instanceof Int8Array))throw new de("Cannot pass non-string to std::string");var S=i&&g?ke(l):l.length,v=je(4+S+1),A=v+4;if(B[v>>>2>>>0]=S,i&&g)Fe(l,L,A,S+1);else if(g)for(g=0;g<S;++g){var I=l.charCodeAt(g);if(255<I)throw ae(A),new de("String has UTF-16 code units that do not fit in 8 bits");L[A+g>>>0]=I}else for(g=0;g<S;++g)L[A+g>>>0]=l[g];return a!==null&&a.push(ae,v),v},argPackAdvance:8,readValueFromPointer:dn,Wa(a){ae(a)}})},x:function(e,t,i){if(t>>>=0,i>>>=0,i=te(i),t===2)var a=pn,l=mn,g=hn,S=()=>pe,v=1;else t===4&&(a=yn,l=gn,g=wn,S=()=>B,v=2);ie(e>>>0,{name:i,fromWireType:A=>{for(var I=B[A>>>2>>>0],R=S(),K,se=A+4,d=0;d<=I;++d){var D=A+4+d*t;(d==I||R[D>>>v]==0)&&(se=a(se,D-se),K===void 0?K=se:(K+=String.fromCharCode(0),K+=se),se=D+t)}return ae(A),K},toWireType:(A,I)=>{if(typeof I!="string")throw new de(`Cannot pass non-string to C++ string type ${i}`);var R=g(I),K=je(4+R+t);return B[K>>>2]=R>>v,l(I,K+4,R+t),A!==null&&A.push(ae,K),K},argPackAdvance:8,readValueFromPointer:Ct,Wa(A){ae(A)}})},fa:function(e,t){t=te(t>>>0),ie(e>>>0,{hb:!0,name:t,argPackAdvance:0,fromWireType:()=>{},toWireType:()=>{}})},ca:()=>!0,o:function(e,t,i){t>>>=0,i>>>=0,e=Z(e>>>0),t=We(t,"emval::as");var a=[],l=ee(a);return B[i>>>2>>>0]=l,t.toWireType(a,e)},h:function(e,t,i,a,l){i>>>=0,a>>>=0,l>>>=0,e=Ne[e>>>0],t=Z(t>>>0),i=ze(i);var g=[];return B[a>>>2>>>0]=ee(g),e(t,i,g,l)},r:function(e,t,i,a){i>>>=0,a>>>=0,e=Ne[e>>>0],t=Z(t>>>0),i=ze(i),e(t,i,null,a)},b:ut,F:function(e,t){return t>>>=0,e=Z(e>>>0),t=Z(t),e==t},u:function(e){return e>>>=0,e===0?ee(Mt()):(e=ze(e),ee(Mt()[e]))},g:function(e,t){var i=En(e,t>>>0),a=i[0];t=a.name+"_$"+i.slice(1).map(function(R){return R.name}).join("_")+"$";var l=Lt[t];if(l!==void 0)return l;l=["retType"];for(var g=[a],S="",v=0;v<e-1;++v)S+=(v!==0?", ":"")+"arg"+v,l.push("argType"+v),g.push(i[1+v]);var A="return function "+Ut("methodCaller_"+t)+`(handle, name, destructors, args) {
`,I=0;for(v=0;v<e-1;++v)A+="    var arg"+v+" = argType"+v+".readValueFromPointer(args"+(I?"+"+I:"")+`);
`,I+=i[v+1].argPackAdvance;for(A+="    var rv = handle[name]("+S+`);
`,v=0;v<e-1;++v)i[v+1].deleteObject&&(A+="    argType"+v+".deleteObject(arg"+v+`);
`);return a.hb||(A+=`    return retType.toWireType(destructors, rv);
`),l.push(A+`};
`),e=Sn(l).apply(null,g),l=vn(e),Lt[t]=l},q:function(e,t){return t>>>=0,e=Z(e>>>0),t=Z(t),ee(e[t])},c:function(e){e>>>=0,4<e&&(Q.get(e).cb+=1)},G:function(e,t,i,a){i>>>=0,a>>>=0,e=Z(e>>>0);var l=Rt[t];return l||(l=On(t),Rt[t]=l),l(e,i,a)},s:function(){return ee([])},k:function(e){e=Z(e>>>0);for(var t=Array(e.length),i=0;i<e.length;i++)t[i]=e[i];return ee(t)},d:function(e){return ee(ze(e>>>0))},j:function(){return ee({})},f:function(e){e>>>=0;for(var t=Z(e);t.length;){var i=t.pop();t.pop()(i)}ut(e)},i:function(e,t,i){t>>>=0,i>>>=0,e=Z(e>>>0),t=Z(t),i=Z(i),e[t]=i},e:function(e,t){return t>>>=0,e=We(e>>>0,"_emval_take_value"),e=e.readValueFromPointer(t),ee(e)},S:function(e,t){e=-9007199254740992>e||9007199254740992<e?NaN:Number(e),t>>>=0,e=new Date(1e3*e),T[t>>>2>>>0]=e.getUTCSeconds(),T[t+4>>>2>>>0]=e.getUTCMinutes(),T[t+8>>>2>>>0]=e.getUTCHours(),T[t+12>>>2>>>0]=e.getUTCDate(),T[t+16>>>2>>>0]=e.getUTCMonth(),T[t+20>>>2>>>0]=e.getUTCFullYear()-1900,T[t+24>>>2>>>0]=e.getUTCDay(),T[t+28>>>2>>>0]=(e.getTime()-Date.UTC(e.getUTCFullYear(),0,1,0,0,0,0))/864e5|0},T:function(e,t){e=-9007199254740992>e||9007199254740992<e?NaN:Number(e),t>>>=0,e=new Date(1e3*e),T[t>>>2>>>0]=e.getSeconds(),T[t+4>>>2>>>0]=e.getMinutes(),T[t+8>>>2>>>0]=e.getHours(),T[t+12>>>2>>>0]=e.getDate(),T[t+16>>>2>>>0]=e.getMonth(),T[t+20>>>2>>>0]=e.getFullYear()-1900,T[t+24>>>2>>>0]=e.getDay(),T[t+28>>>2>>>0]=(Ee(e.getFullYear())?kt:Ft)[e.getMonth()]+e.getDate()-1|0,T[t+36>>>2>>>0]=-(60*e.getTimezoneOffset());var i=new Date(e.getFullYear(),6,1).getTimezoneOffset(),a=new Date(e.getFullYear(),0,1).getTimezoneOffset();T[t+32>>>2>>>0]=(i!=a&&e.getTimezoneOffset()==Math.min(a,i))|0},U:function(e){e>>>=0;var t=new Date(T[e+20>>>2>>>0]+1900,T[e+16>>>2>>>0],T[e+12>>>2>>>0],T[e+8>>>2>>>0],T[e+4>>>2>>>0],T[e>>>2>>>0],0),i=T[e+32>>>2>>>0],a=t.getTimezoneOffset(),l=new Date(t.getFullYear(),6,1).getTimezoneOffset(),g=new Date(t.getFullYear(),0,1).getTimezoneOffset(),S=Math.min(g,l);return 0>i?T[e+32>>>2>>>0]=+(l!=g&&S==a):0<i!=(S==a)&&(l=Math.max(g,l),t.setTime(t.getTime()+6e4*((0<i?S:l)-a))),T[e+24>>>2>>>0]=t.getDay(),T[e+28>>>2>>>0]=(Ee(t.getFullYear())?kt:Ft)[t.getMonth()]+t.getDate()-1|0,T[e>>>2>>>0]=t.getSeconds(),T[e+4>>>2>>>0]=t.getMinutes(),T[e+8>>>2>>>0]=t.getHours(),T[e+12>>>2>>>0]=t.getDate(),T[e+16>>>2>>>0]=t.getMonth(),T[e+20>>>2>>>0]=t.getYear(),BigInt(t.getTime()/1e3)},Q:function(){return-52},R:function(){},J:function(e,t,i){function a(A){return(A=A.toTimeString().match(/\(([A-Za-z ]+)\)$/))?A[1]:"GMT"}i>>>=0;var l=new Date().getFullYear(),g=new Date(l,0,1),S=new Date(l,6,1);l=g.getTimezoneOffset();var v=S.getTimezoneOffset();B[e>>>0>>>2>>>0]=60*Math.max(l,v),T[t>>>0>>>2>>>0]=+(l!=v),e=a(g),t=a(S),e=Wt(e),t=Wt(t),v<l?(B[i>>>2>>>0]=e,B[i+4>>>2>>>0]=t):(B[i>>>2>>>0]=t,B[i+4>>>2>>>0]=e)},t:()=>{De("")},B:()=>Date.now(),K:function(){return 4294901760},n:()=>performance.now(),Z:function(e,t,i){return t>>>=0,L.copyWithin(e>>>0>>>0,t>>>0,t+(i>>>0)>>>0)},I:function(e){e>>>=0;var t=L.length;if(4294901760<e)return!1;for(var i=1;4>=i;i*=2){var a=t*(1+.2/i);a=Math.min(a,e+100663296);var l=Math;a=Math.max(e,a);e:{l=(l.min.call(l,4294901760,a+(65536-a%65536)%65536)-W.buffer.byteLength+65535)/65536;try{W.grow(l),C();var g=1;break e}catch{}g=void 0}if(g)return!0}return!1},X:function(e,t){e>>>=0,t>>>=0;var i=0;return zt().forEach((a,l)=>{var g=t+i;for(l=B[e+4*l>>>2>>>0]=g,g=0;g<a.length;++g)j[l++>>>0>>>0]=a.charCodeAt(g);j[l>>>0>>>0]=0,i+=a.length+1}),0},Y:function(e,t){e>>>=0,t>>>=0;var i=zt();B[e>>>2>>>0]=i.length;var a=0;return i.forEach(l=>a+=l.length+1),B[t>>>2>>>0]=a,0},w:()=>52,z:function(){return 52},W:function(){return 70},y:function(e,t,i,a){t>>>=0,i>>>=0,a>>>=0;for(var l=0,g=0;g<i;g++){var S=B[t>>>2>>>0],v=B[t+4>>>2>>>0];t+=8;for(var A=0;A<v;A++){var I=L[S+A>>>0],R=An[e];I===0||I===10?((e===1?_:U)(Le(R,0)),R.length=0):R.push(I)}l+=v}return B[a>>>2>>>0]=l,0},ga:jt,m:function(e,t,i,a){return jt(e>>>0,t>>>0,i>>>0,a>>>0)}},P=function(){var e={a:In};return ne++,Ue(e,function(t){P=t.instance.exports,P=xn(),W=P.ha,C(),ve.unshift(P.ia),ne--,ne==0&&(H!==null&&(clearInterval(H),H=null),X&&(t=X,X=null,t()))}).catch(s),{}}();r._OrtInit=(e,t)=>(r._OrtInit=P.ja)(e,t),r._OrtGetLastError=(e,t)=>(r._OrtGetLastError=P.ka)(e,t),r._OrtCreateSessionOptions=(e,t,i,a,l,g,S,v,A,I)=>(r._OrtCreateSessionOptions=P.la)(e,t,i,a,l,g,S,v,A,I),r._OrtAppendExecutionProvider=(e,t)=>(r._OrtAppendExecutionProvider=P.ma)(e,t),r._OrtAddFreeDimensionOverride=(e,t,i)=>(r._OrtAddFreeDimensionOverride=P.na)(e,t,i),r._OrtAddSessionConfigEntry=(e,t,i)=>(r._OrtAddSessionConfigEntry=P.oa)(e,t,i),r._OrtReleaseSessionOptions=e=>(r._OrtReleaseSessionOptions=P.pa)(e),r._OrtCreateSession=(e,t,i)=>(r._OrtCreateSession=P.qa)(e,t,i),r._OrtReleaseSession=e=>(r._OrtReleaseSession=P.ra)(e),r._OrtGetInputOutputCount=(e,t,i)=>(r._OrtGetInputOutputCount=P.sa)(e,t,i),r._OrtGetInputName=(e,t)=>(r._OrtGetInputName=P.ta)(e,t),r._OrtGetOutputName=(e,t)=>(r._OrtGetOutputName=P.ua)(e,t),r._OrtFree=e=>(r._OrtFree=P.va)(e),r._OrtCreateTensor=(e,t,i,a,l,g)=>(r._OrtCreateTensor=P.wa)(e,t,i,a,l,g),r._OrtGetTensorData=(e,t,i,a,l)=>(r._OrtGetTensorData=P.xa)(e,t,i,a,l),r._OrtReleaseTensor=e=>(r._OrtReleaseTensor=P.ya)(e),r._OrtCreateRunOptions=(e,t,i,a)=>(r._OrtCreateRunOptions=P.za)(e,t,i,a),r._OrtAddRunConfigEntry=(e,t,i)=>(r._OrtAddRunConfigEntry=P.Aa)(e,t,i),r._OrtReleaseRunOptions=e=>(r._OrtReleaseRunOptions=P.Ba)(e),r._OrtCreateBinding=e=>(r._OrtCreateBinding=P.Ca)(e),r._OrtBindInput=(e,t,i)=>(r._OrtBindInput=P.Da)(e,t,i),r._OrtBindOutput=(e,t,i,a)=>(r._OrtBindOutput=P.Ea)(e,t,i,a),r._OrtClearBoundOutputs=e=>(r._OrtClearBoundOutputs=P.Fa)(e),r._OrtReleaseBinding=e=>(r._OrtReleaseBinding=P.Ga)(e),r._OrtRunWithBinding=(e,t,i,a,l)=>(r._OrtRunWithBinding=P.Ha)(e,t,i,a,l),r._OrtRun=(e,t,i,a,l,g,S,v)=>(r._OrtRun=P.Ia)(e,t,i,a,l,g,S,v),r._OrtEndProfiling=e=>(r._OrtEndProfiling=P.Ja)(e);var je=r._malloc=e=>(je=r._malloc=P.Ka)(e),ae=r._free=e=>(ae=r._free=P.La)(e),Gt=e=>(Gt=P.Ma)(e);r.__embind_initialize_bindings=()=>(r.__embind_initialize_bindings=P.Na)();var Yt=()=>(Yt=P.Pa)(),Vt=e=>(Vt=P.Qa)(e),Xt=e=>(Xt=P.Ra)(e);function xn(){var e=P;e=Object.assign({},e);var t=a=>()=>a()>>>0,i=a=>l=>a(l)>>>0;return e.__errno_location=t(e.__errno_location),e.Ka=i(e.Ka),e.Ma=i(e.Ma),e.Pa=t(e.Pa),e.Ra=i(e.Ra),e}r.stackAlloc=Xt,r.stackSave=Yt,r.stackRestore=Vt,r.UTF8ToString=Re,r.stringToUTF8=(e,t,i)=>Fe(e,L,t,i),r.lengthBytesUTF8=ke;var He;X=function e(){He||qt(),He||(X=e)};function qt(){if(!(0<ne)){for(;0<fe.length;)fe.shift()(r);if(!(0<ne||He||(He=!0,r.calledRun=!0,V))){for(;0<ve.length;)ve.shift()(r);for(u(r);0<re.length;)re.shift()(r)}}}return qt(),n.ready}})();typeof xr=="object"&&typeof yt=="object"?yt.exports=Ir:typeof define=="function"&&define.amd&&define([],()=>Ir)});var bt,Wn,gt,wt,et,Br,zn,Nn,$n,Cr,z,Te=M(()=>{"use strict";bt=_r();Wn=bt,wt=!1,et=!1,Br=!1,zn=()=>{try{return typeof SharedArrayBuffer>"u"?!1:(typeof MessageChannel<"u"&&new MessageChannel().port1.postMessage(new SharedArrayBuffer(1)),WebAssembly.validate(new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,2,1,0,5,4,1,3,1,1,10,11,1,9,0,65,0,254,16,2,0,26,11])))}catch{return!1}},Nn=()=>{try{return WebAssembly.validate(new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,2,1,0,10,30,1,28,0,65,0,253,15,253,12,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,253,186,1,26,11]))}catch{return!1}},$n=(o,n)=>o?n?"ort-wasm-simd-threaded.wasm":"ort-wasm-simd.wasm":n?"ort-wasm-threaded.wasm":"ort-wasm.wasm",Cr=async o=>{if(wt)return Promise.resolve();if(et)throw new Error("multiple calls to 'initializeWebAssembly()' detected.");if(Br)throw new Error("previous call to 'initializeWebAssembly()' failed.");et=!0;let n=o.initTimeout,r=o.numThreads,u=o.simd,s=r>1&&zn(),m=u&&Nn(),f=o.wasmPaths,p=typeof f=="string"?f:void 0,h=$n(m,s),c=typeof f=="object"?f[h]:void 0,y=!1,b=[];if(n>0&&b.push(new Promise(w=>{setTimeout(()=>{y=!0,w()},n)})),b.push(new Promise((w,E)=>{(s?Wn:bt)({locateFile:(_,U)=>_.endsWith(".wasm")?c||(p??U)+h:U+_}).then(_=>{et=!1,wt=!0,gt=_,w()},_=>{et=!1,Br=!0,E(_)})})),await Promise.race(b),y)throw new Error(`WebAssembly backend initializing failed due to timeout: ${n}ms`)},z=()=>{if(wt&&gt)return gt;throw new Error("WebAssembly is not initialized yet.")}});var N,xe,F,tt=M(()=>{"use strict";Te();N=(o,n)=>{let r=z(),u=r.lengthBytesUTF8(o)+1,s=r._malloc(u);return r.stringToUTF8(o,s,u),n.push(s),s},xe=(o,n,r,u)=>{if(typeof o=="object"&&o!==null){if(r.has(o))throw new Error("Circular reference in options");r.add(o)}Object.entries(o).forEach(([s,m])=>{let f=n?n+s:s;if(typeof m=="object")xe(m,f+".",r,u);else if(typeof m=="string"||typeof m=="number")u(f,m.toString());else if(typeof m=="boolean")u(f,m?"1":"0");else throw new Error(`Can't handle extra config type: ${typeof m}`)})},F=o=>{let n=z(),r=n.stackSave();try{let u=n.stackAlloc(8);n._OrtGetLastError(u,u+4);let s=n.HEAP32[u/4],m=n.HEAPU32[u/4+1],f=m?n.UTF8ToString(m):"";throw new Error(`${o} ERROR_CODE: ${s}, ERROR_MESSAGE: ${f}`)}finally{n.stackRestore(r)}}});var Dr,Mr=M(()=>{"use strict";Te();tt();Dr=o=>{let n=z(),r=0,u=[],s=o||{};try{if(o?.logSeverityLevel===void 0)s.logSeverityLevel=2;else if(typeof o.logSeverityLevel!="number"||!Number.isInteger(o.logSeverityLevel)||o.logSeverityLevel<0||o.logSeverityLevel>4)throw new Error(`log serverity level is not valid: ${o.logSeverityLevel}`);if(o?.logVerbosityLevel===void 0)s.logVerbosityLevel=0;else if(typeof o.logVerbosityLevel!="number"||!Number.isInteger(o.logVerbosityLevel))throw new Error(`log verbosity level is not valid: ${o.logVerbosityLevel}`);o?.terminate===void 0&&(s.terminate=!1);let m=0;return o?.tag!==void 0&&(m=N(o.tag,u)),r=n._OrtCreateRunOptions(s.logSeverityLevel,s.logVerbosityLevel,!!s.terminate,m),r===0&&F("Can't create run options."),o?.extra!==void 0&&xe(o.extra,"",new WeakSet,(f,p)=>{let h=N(f,u),c=N(p,u);n._OrtAddRunConfigEntry(r,h,c)!==0&&F(`Can't set a run config entry: ${f} - ${p}.`)}),[r,u]}catch(m){throw r!==0&&n._OrtReleaseRunOptions(r),u.forEach(f=>n._free(f)),m}}});var jn,Hn,Gn,Yn,Ur,Lr=M(()=>{"use strict";Te();tt();jn=o=>{switch(o){case"disabled":return 0;case"basic":return 1;case"extended":return 2;case"all":return 99;default:throw new Error(`unsupported graph optimization level: ${o}`)}},Hn=o=>{switch(o){case"sequential":return 0;case"parallel":return 1;default:throw new Error(`unsupported execution mode: ${o}`)}},Gn=o=>{o.extra||(o.extra={}),o.extra.session||(o.extra.session={});let n=o.extra.session;n.use_ort_model_bytes_directly||(n.use_ort_model_bytes_directly="1"),o.executionProviders&&o.executionProviders.some(r=>(typeof r=="string"?r:r.name)==="webgpu")&&(o.enableMemPattern=!1)},Yn=(o,n,r)=>{for(let u of n){let s=typeof u=="string"?u:u.name;switch(s){case"xnnpack":s="XNNPACK";break;case"webnn":if(s="WEBNN",typeof u!="string"){let f=u;if(f?.deviceType){let p=N("deviceType",r),h=N(f.deviceType,r);z()._OrtAddSessionConfigEntry(o,p,h)!==0&&F(`Can't set a session config entry: 'deviceType' - ${f.deviceType}.`)}if(f?.numThreads){let p=f.numThreads;(typeof p!="number"||!Number.isInteger(p)||p<0)&&(p=0);let h=N("numThreads",r),c=N(p.toString(),r);z()._OrtAddSessionConfigEntry(o,h,c)!==0&&F(`Can't set a session config entry: 'numThreads' - ${f.numThreads}.`)}if(f?.powerPreference){let p=N("powerPreference",r),h=N(f.powerPreference,r);z()._OrtAddSessionConfigEntry(o,p,h)!==0&&F(`Can't set a session config entry: 'powerPreference' - ${f.powerPreference}.`)}}break;case"webgpu":if(s="JS",typeof u!="string"){let f=u;if(f?.preferredLayout){if(f.preferredLayout!=="NCHW"&&f.preferredLayout!=="NHWC")throw new Error(`preferredLayout must be either 'NCHW' or 'NHWC': ${f.preferredLayout}`);let p=N("preferredLayout",r),h=N(f.preferredLayout,r);z()._OrtAddSessionConfigEntry(o,p,h)!==0&&F(`Can't set a session config entry: 'preferredLayout' - ${f.preferredLayout}.`)}}break;case"wasm":case"cpu":continue;default:throw new Error(`not supported execution provider: ${s}`)}let m=N(s,r);z()._OrtAppendExecutionProvider(o,m)!==0&&F(`Can't append execution provider: ${s}.`)}},Ur=o=>{let n=z(),r=0,u=[],s=o||{};Gn(s);try{let m=jn(s.graphOptimizationLevel??"all"),f=Hn(s.executionMode??"sequential"),p=typeof s.logId=="string"?N(s.logId,u):0,h=s.logSeverityLevel??2;if(!Number.isInteger(h)||h<0||h>4)throw new Error(`log serverity level is not valid: ${h}`);let c=s.logVerbosityLevel??0;if(!Number.isInteger(c)||c<0||c>4)throw new Error(`log verbosity level is not valid: ${c}`);let y=typeof s.optimizedModelFilePath=="string"?N(s.optimizedModelFilePath,u):0;if(r=n._OrtCreateSessionOptions(m,!!s.enableCpuMemArena,!!s.enableMemPattern,f,!!s.enableProfiling,0,p,h,c,y),r===0&&F("Can't create session options."),s.executionProviders&&Yn(r,s.executionProviders,u),s.freeDimensionOverrides)for(let[b,w]of Object.entries(s.freeDimensionOverrides)){if(typeof b!="string")throw new Error(`free dimension override name must be a string: ${b}`);if(typeof w!="number"||!Number.isInteger(w)||w<0)throw new Error(`free dimension override value must be a non-negative integer: ${w}`);let E=N(b,u);n._OrtAddFreeDimensionOverride(r,E,w)!==0&&F(`Can't set a free dimension override: ${b} - ${w}.`)}return s.extra!==void 0&&xe(s.extra,"",new WeakSet,(b,w)=>{let E=N(b,u),x=N(w,u);n._OrtAddSessionConfigEntry(r,E,x)!==0&&F(`Can't set a session config entry: ${b} - ${w}.`)}),[r,u]}catch(m){throw r!==0&&n._OrtReleaseSessionOptions(r),u.forEach(f=>n._free(f)),m}}});var vt,Rr,Et,kr,Fr,rt,Wr,Tt=M(()=>{"use strict";vt=o=>{switch(o){case"int8":return 3;case"uint8":return 2;case"bool":return 9;case"int16":return 5;case"uint16":return 4;case"int32":return 6;case"uint32":return 12;case"float16":return 10;case"float32":return 1;case"float64":return 11;case"string":return 8;case"int64":return 7;case"uint64":return 13;default:throw new Error(`unsupported data type: ${o}`)}},Rr=o=>{switch(o){case 3:return"int8";case 2:return"uint8";case 9:return"bool";case 5:return"int16";case 4:return"uint16";case 6:return"int32";case 12:return"uint32";case 10:return"float16";case 1:return"float32";case 11:return"float64";case 8:return"string";case 7:return"int64";case 13:return"uint64";default:throw new Error(`unsupported data type: ${o}`)}},Et=o=>[void 0,4,1,1,2,2,4,8,void 0,1,2,8,4,8,void 0,void 0,void 0][o],kr=o=>{switch(o){case"float16":return Uint16Array;case"float32":return Float32Array;case"uint8":return Uint8Array;case"int8":return Int8Array;case"uint16":return Uint16Array;case"int16":return Int16Array;case"int32":return Int32Array;case"bool":return Uint8Array;case"float64":return Float64Array;case"uint32":return Uint32Array;case"int64":return BigInt64Array;case"uint64":return BigUint64Array;default:throw new Error(`unsupported type: ${o}`)}},Fr=o=>{switch(o){case"verbose":return 0;case"info":return 1;case"warning":return 2;case"error":return 3;case"fatal":return 4;default:throw new Error(`unsupported logging level: ${o}`)}},rt=o=>o==="float32"||o==="int32"||o==="int64"||o==="bool"||o==="float16"||o==="uint32",Wr=o=>{switch(o){case"none":return 0;case"cpu":return 1;case"cpu-pinned":return 2;case"texture":return 3;case"gpu-buffer":return 4;default:throw new Error(`unsupported data location: ${o}`)}}});var Nr,Vn,Xn,$r,_e,jr,St,Ot,Hr,Gr,zr,Yr,Vr,Xr=M(()=>{"use strict";Mr();Lr();Tt();Te();tt();Nr=!1,Vn=o=>{let n=z(),r=n.stackSave();try{let u=n.stackAlloc(8);return n._OrtGetInputOutputCount(o,u,u+4)!==0&&F("Can't get session input/output count."),[n.HEAP32[u/4],n.HEAP32[u/4+1]]}finally{n.stackRestore(r)}},Xn=(o,n)=>{z()._OrtInit(o,n)!==0&&F("Can't initialize onnxruntime.")},$r=async o=>{Xn(o.wasm.numThreads,Fr(o.logLevel)),Nr=!0},_e=new Map,jr=()=>Nr,St=o=>{let n=z(),r=n._malloc(o.byteLength);if(r===0)throw new Error(`Can't create a session. failed to allocate a buffer of size ${o.byteLength}.`);return n.HEAPU8.set(o,r),[r,o.byteLength]},Ot=(o,n)=>{let r=z(),u=0,s=0,m=0,f=[],p=[],h=[];try{[s,f]=Ur(n),u=r._OrtCreateSession(o[0],o[1],s),u===0&&F("Can't create a session.");let[c,y]=Vn(u),b=[],w=[],E=[];for(let O=0;O<c;O++){let _=r._OrtGetInputName(u,O);_===0&&F("Can't get an input name."),p.push(_),b.push(r.UTF8ToString(_))}for(let O=0;O<y;O++){let _=r._OrtGetOutputName(u,O);_===0&&F("Can't get an output name."),h.push(_);let U=r.UTF8ToString(_);w.push(U)}let x=null;return _e.set(u,[u,p,h,x]),[u,b,w]}catch(c){throw p.forEach(y=>r._OrtFree(y)),h.forEach(y=>r._OrtFree(y)),m!==0&&r._OrtReleaseBinding(m),u!==0&&r._OrtReleaseSession(u),c}finally{r._free(o[0]),s!==0&&r._OrtReleaseSessionOptions(s),f.forEach(c=>r._free(c))}},Hr=(o,n)=>{let r=St(o);return Ot(r,n)},Gr=o=>{let n=z(),r=_e.get(o);if(!r)throw new Error(`cannot release session. invalid session id: ${o}`);let[u,s,m,f]=r;f&&n._OrtReleaseBinding(f.handle),n.jsepUnregisterBuffers?.(o),s.forEach(p=>n._OrtFree(p)),m.forEach(p=>n._OrtFree(p)),n._OrtReleaseSession(u),_e.delete(o)},zr=(o,n,r,u,s)=>{if(!o){n.push(0);return}let m=z(),f=o[0],p=o[1],h=o[3],c,y;if(f==="string"&&h==="gpu-buffer")throw new Error("String tensor is not supported on GPU.");if(h==="gpu-buffer"){let E=o[2].gpuBuffer,x=Et(vt(f));y=p.reduce((O,_)=>O*_,1)*x,c=m.jsepRegisterBuffer(u,s,E,y)}else{let E=o[2];if(Array.isArray(E)){y=4*E.length,c=m._malloc(y),r.push(c);let x=c/4;for(let O=0;O<E.length;O++){if(typeof E[O]!="string")throw new TypeError(`tensor data at index ${O} is not a string`);m.HEAPU32[x++]=N(E[O],r)}}else y=E.byteLength,c=m._malloc(y),r.push(c),m.HEAPU8.set(new Uint8Array(E.buffer,E.byteOffset,y),c)}let b=m.stackSave(),w=m.stackAlloc(4*p.length);try{let E=w/4;p.forEach(O=>m.HEAP32[E++]=O);let x=m._OrtCreateTensor(vt(f),c,y,w,p.length,Wr(h));x===0&&F(`Can't create tensor for input/output. session=${u}, index=${s}.`),n.push(x)}finally{m.stackRestore(b)}},Yr=async(o,n,r,u,s,m)=>{let f=z(),p=_e.get(o);if(!p)throw new Error(`cannot run inference. invalid session id: ${o}`);let[h,c,y,b]=p,w=n.length,E=u.length,x=0,O=[],_=[],U=[],W=[],V=f.stackSave(),j=f.stackAlloc(w*4),L=f.stackAlloc(w*4),oe=f.stackAlloc(E*4),pe=f.stackAlloc(E*4);try{[x,O]=Dr(m);for(let C=0;C<w;C++)zr(r[C],_,W,o,n[C]);for(let C=0;C<E;C++)zr(s[C],U,W,o,w+u[C]);let T=j/4,B=L/4,Be=oe/4,Ce=pe/4;for(let C=0;C<w;C++)f.HEAPU32[T++]=_[C],f.HEAPU32[B++]=c[n[C]];for(let C=0;C<E;C++)f.HEAPU32[Be++]=U[C],f.HEAPU32[Ce++]=y[u[C]];let Se;Se=await f._OrtRun(h,L,j,w,pe,E,oe,x),Se!==0&&F("failed to call OrtRun().");let ue=[];for(let C=0;C<E;C++){let fe=f.HEAPU32[oe/4+C];if(fe===U[C]){ue.push(s[C]);continue}let ve=f.stackSave(),re=f.stackAlloc(4*4),ne=!1,H,X=0;try{f._OrtGetTensorData(fe,re,re+4,re+8,re+12)!==0&&F(`Can't access output tensor data on index ${C}.`);let me=re/4,le=f.HEAPU32[me++];X=f.HEAPU32[me++];let Oe=f.HEAPU32[me++],Me=f.HEAPU32[me++],he=[];for(let q=0;q<Me;q++)he.push(f.HEAPU32[Oe/4+q]);f._OrtFree(Oe);let ce=he.reduce((q,G)=>q*G,1);H=Rr(le);let Ue=b?.outputPreferredLocations[u[C]];if(H==="string"){if(Ue==="gpu-buffer")throw new Error("String tensor is not supported on GPU.");let q=[],G=X/4;for(let Ae=0;Ae<ce;Ae++){let Pe=f.HEAPU32[G++],Le=Ae===ce-1?void 0:f.HEAPU32[G]-Pe;q.push(f.UTF8ToString(Pe,Le))}ue.push([H,he,q,"cpu"])}else if(Ue==="gpu-buffer"&&ce>0){let q=f.jsepGetBuffer(X),G=Et(le);if(G===void 0||!rt(H))throw new Error(`Unsupported data type: ${H}`);ne=!0,ue.push([H,he,{gpuBuffer:q,download:f.jsepCreateDownloader(q,ce*G,H),dispose:()=>{f._OrtReleaseTensor(fe)}},"gpu-buffer"])}else{let q=kr(H),G=new q(ce);new Uint8Array(G.buffer,G.byteOffset,G.byteLength).set(f.HEAPU8.subarray(X,X+G.byteLength)),ue.push([H,he,G,"cpu"])}}finally{f.stackRestore(ve),H==="string"&&X&&f._free(X),ne||f._OrtReleaseTensor(fe)}}return b&&f._OrtClearBoundOutputs(b.handle),ue}finally{f.stackRestore(V),_.forEach(T=>f._OrtReleaseTensor(T)),U.forEach(T=>f._OrtReleaseTensor(T)),W.forEach(T=>f._free(T)),x!==0&&f._OrtReleaseRunOptions(x),O.forEach(T=>f._free(T))}},Vr=o=>{let n=z(),r=_e.get(o);if(!r)throw new Error("invalid session id");let u=r[0],s=n._OrtEndProfiling(u);s===0&&F("Can't get an profile file name."),n._OrtFree(s)}});var si,qr,Jr,Zr,Kr,At,Qr,en,tn,rn,Pt=M(()=>{"use strict";be();Xr();Te();si=typeof document<"u"?document?.currentScript?.src:void 0,qr=async()=>Cr($.wasm),Jr=async o=>{await $r(o)},Zr=async o=>St(o),Kr=async(o,n)=>Ot(o,n),At=async(o,n)=>Hr(o,n),Qr=async o=>{Gr(o)},en=async(o,n,r,u,s,m)=>Yr(o,n,r,u,s,m),tn=async o=>{Vr(o)},rn=async()=>jr()});var nt,nn,Jn,ot,on=M(()=>{"use strict";be();Pt();Tt();nn=(o,n)=>{switch(o.location){case"cpu":return[o.type,o.dims,o.data,"cpu"];case"gpu-buffer":return[o.type,o.dims,{gpuBuffer:o.gpuBuffer},"gpu-buffer"];default:throw new Error(`invalid data location: ${o.location} for ${n()}`)}},Jn=o=>{switch(o[3]){case"cpu":return new Y(o[0],o[2],o[1]);case"gpu-buffer":{let n=o[0];if(!rt(n))throw new Error(`not supported data type: ${n} for deserializing GPU tensor`);let{gpuBuffer:r,download:u,dispose:s}=o[2];return Y.fromGpuBuffer(r,{dataType:n,dims:o[1],download:u,dispose:s})}default:throw new Error(`invalid data location: ${o[3]}`)}},ot=class{async createSessionAllocate(n){let r=await fetch(n);if(r.status!==200)throw new Error(`failed to load model: ${n}`);let u=await r.arrayBuffer();return Zr(new Uint8Array(u))}async loadModel(n,r){if(await rn()||(nt||(nt=Jr($)),await nt,nt=void 0),typeof n=="string")if(typeof process<"u"&&process.versions&&process.versions.node){let u=await(void 0)(n);[this.sessionId,this.inputNames,this.outputNames]=await At(u,r)}else{let u=await this.createSessionAllocate(n);[this.sessionId,this.inputNames,this.outputNames]=await Kr(u,r)}else[this.sessionId,this.inputNames,this.outputNames]=await At(n,r)}async dispose(){return Qr(this.sessionId)}async run(n,r,u){let s=[],m=[];Object.entries(n).forEach(w=>{let E=w[0],x=w[1],O=this.inputNames.indexOf(E);if(O===-1)throw new Error(`invalid input '${E}'`);s.push(x),m.push(O)});let f=[],p=[];Object.entries(r).forEach(w=>{let E=w[0],x=w[1],O=this.outputNames.indexOf(E);if(O===-1)throw new Error(`invalid output '${E}'`);f.push(x),p.push(O)});let h=s.map((w,E)=>nn(w,()=>`input "${this.inputNames[m[E]]}"`)),c=f.map((w,E)=>w?nn(w,()=>`output "${this.outputNames[p[E]]}"`):null),y=await en(this.sessionId,m,h,p,c,u),b={};for(let w=0;w<y.length;w++)b[this.outputNames[p[w]]]=f[w]??Jn(y[w]);return b}startProfiling(){}endProfiling(){tn(this.sessionId)}}});var Zn,it,an=M(()=>{"use strict";be();Pt();on();Zn=()=>{if((typeof $.wasm.initTimeout!="number"||$.wasm.initTimeout<0)&&($.wasm.initTimeout=0),typeof $.wasm.simd!="boolean"&&($.wasm.simd=!0),typeof $.wasm.proxy!="boolean"&&($.wasm.proxy=!1),typeof $.wasm.numThreads!="number"||!Number.isInteger($.wasm.numThreads)||$.wasm.numThreads<=0){let o=typeof navigator>"u"?(void 0)().length:navigator.hardwareConcurrency;$.wasm.numThreads=Math.min(4,Math.ceil((o||1)/2))}},it=class{async init(){Zn(),await qr()}async createInferenceSessionHandler(n,r){let u=new ot;return await u.loadModel(n,r),Promise.resolve(u)}}});var sn={};Ge(sn,{wasmBackend:()=>Kn});var Kn,un=M(()=>{"use strict";an();Kn=new it});be();be();be();var Tr="1.17.0";var Pi=ht;{let o=(un(),dt(sn)).wasmBackend;we("cpu",o,10),we("wasm",o,10),we("xnnpack",o,9),we("webnn",o,9)}Object.defineProperty($.versions,"web",{value:Tr,enumerable:!0});export{Un as InferenceSession,Y as Tensor,Rn as TrainingSession,Pi as default,$ as env,we as registerBackend};
//# sourceMappingURL=ort.wasm-core.min.js.map
