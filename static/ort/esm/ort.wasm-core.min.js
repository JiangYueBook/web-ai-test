/*!
 * ONNX Runtime Web v1.17.0
 * Copyright (c) Microsoft Corporation. All rights reserved.
 * Licensed under the MIT License.
 */
var ct=Object.defineProperty;var In=Object.getOwnPropertyDescriptor;var xn=Object.getOwnPropertyNames;var Bn=Object.prototype.hasOwnProperty;var U=(o,r)=>()=>(o&&(r=o(o=0)),r);var _n=(o,r)=>()=>(r||o((r={exports:{}}).exports,r),r.exports),Ge=(o,r)=>{for(var n in r)ct(o,n,{get:r[n],enumerable:!0})},Cn=(o,r,n,u)=>{if(r&&typeof r=="object"||typeof r=="function")for(let s of xn(r))!Bn.call(o,s)&&s!==n&&ct(o,s,{get:()=>r[s],enumerable:!(u=In(r,s))||u.enumerable});return o};var lt=o=>Cn(ct({},"__esModule",{value:!0}),o);var Ye,ge,we,Ve,qe=U(()=>{"use strict";Ye=new Map,ge=[],we=(o,r,n)=>{if(r&&typeof r.init=="function"&&typeof r.createInferenceSessionHandler=="function"){let u=Ye.get(o);if(u===void 0)Ye.set(o,{backend:r,priority:n});else{if(u.priority>n)return;if(u.priority===n&&u.backend!==r)throw new Error(`cannot register backend "${o}" using priority ${n}`)}if(n>=0){let s=ge.indexOf(o);s!==-1&&ge.splice(s,1);for(let p=0;p<ge.length;p++)if(Ye.get(ge[p]).priority<=n){ge.splice(p,0,o);return}ge.push(o)}return}throw new TypeError("not a valid backend")},Ve=async o=>{let r=o.length===0?ge:o,n=[];for(let u of r){let s=Ye.get(u);if(s){if(s.initialized)return s.backend;if(s.aborted)continue;let p=!!s.initPromise;try{return p||(s.initPromise=s.backend.init(u)),await s.initPromise,s.initialized=!0,s.backend}catch(f){p||n.push({name:u,err:f}),s.aborted=!0}finally{delete s.initPromise}}}throw new Error(`no available backend found. ERR: ${n.map(u=>`[${u.name}] ${u.err}`).join(", ")}`)}});var Xt=U(()=>{"use strict";qe()});var Jt,Zt=U(()=>{"use strict";Jt="1.17.0"});var Kt,dt,Qt=U(()=>{"use strict";Zt();Kt="warning",dt={wasm:{},webgl:{},webgpu:{},versions:{common:Jt},set logLevel(o){if(o!==void 0){if(typeof o!="string"||["verbose","info","warning","error","fatal"].indexOf(o)===-1)throw new Error(`Unsupported logging level: ${o}`);Kt=o}},get logLevel(){return Kt}};Object.defineProperty(dt,"logLevel",{enumerable:!0})});var H,er=U(()=>{"use strict";Qt();H=dt});var tr,rr,nr=U(()=>{"use strict";tr=(o,r)=>{let n=document.createElement("canvas");n.width=o.dims[3],n.height=o.dims[2];let u=n.getContext("2d");if(u!=null){let s,p;r?.tensorLayout!==void 0&&r.tensorLayout==="NHWC"?(s=o.dims[2],p=o.dims[3]):(s=o.dims[3],p=o.dims[2]);let f=r?.format!==void 0?r.format:"RGB",m=r?.norm,h,l;m===void 0||m.mean===void 0?h=[255,255,255,255]:typeof m.mean=="number"?h=[m.mean,m.mean,m.mean,m.mean]:(h=[m.mean[0],m.mean[1],m.mean[2],0],m.mean[3]!==void 0&&(h[3]=m.mean[3])),m===void 0||m.bias===void 0?l=[0,0,0,0]:typeof m.bias=="number"?l=[m.bias,m.bias,m.bias,m.bias]:(l=[m.bias[0],m.bias[1],m.bias[2],0],m.bias[3]!==void 0&&(l[3]=m.bias[3]));let y=p*s,b=0,w=y,E=y*2,x=-1;f==="RGBA"?(b=0,w=y,E=y*2,x=y*3):f==="RGB"?(b=0,w=y,E=y*2):f==="RBG"&&(b=0,E=y,w=y*2);for(let I=0;I<p;I++)for(let M=0;M<s;M++){let B=(o.data[b++]-l[0])*h[0],L=(o.data[w++]-l[1])*h[1],j=(o.data[E++]-l[2])*h[2],z=x===-1?255:(o.data[x++]-l[3])*h[3];u.fillStyle="rgba("+B+","+L+","+j+","+z+")",u.fillRect(M,I,1,1)}return n.toDataURL()}else throw new Error("Can not access image data")},rr=(o,r)=>{let n=document.createElement("canvas").getContext("2d"),u;if(n!=null){let s,p,f;r?.tensorLayout!==void 0&&r.tensorLayout==="NHWC"?(s=o.dims[2],p=o.dims[1],f=o.dims[3]):(s=o.dims[3],p=o.dims[2],f=o.dims[1]);let m=r!==void 0&&r.format!==void 0?r.format:"RGB",h=r?.norm,l,y;h===void 0||h.mean===void 0?l=[255,255,255,255]:typeof h.mean=="number"?l=[h.mean,h.mean,h.mean,h.mean]:(l=[h.mean[0],h.mean[1],h.mean[2],255],h.mean[3]!==void 0&&(l[3]=h.mean[3])),h===void 0||h.bias===void 0?y=[0,0,0,0]:typeof h.bias=="number"?y=[h.bias,h.bias,h.bias,h.bias]:(y=[h.bias[0],h.bias[1],h.bias[2],0],h.bias[3]!==void 0&&(y[3]=h.bias[3]));let b=p*s;if(r!==void 0&&(r.format!==void 0&&f===4&&r.format!=="RGBA"||f===3&&r.format!=="RGB"&&r.format!=="BGR"))throw new Error("Tensor format doesn't match input tensor dims");let w=4,E=0,x=1,I=2,M=3,B=0,L=b,j=b*2,z=-1;m==="RGBA"?(B=0,L=b,j=b*2,z=b*3):m==="RGB"?(B=0,L=b,j=b*2):m==="RBG"&&(B=0,j=b,L=b*2),u=n.createImageData(s,p);for(let R=0;R<p*s;E+=w,x+=w,I+=w,M+=w,R++)u.data[E]=(o.data[B++]-y[0])*l[0],u.data[x]=(o.data[L++]-y[1])*l[1],u.data[I]=(o.data[j++]-y[2])*l[2],u.data[M]=z===-1?255:(o.data[z++]-y[3])*l[3]}else throw new Error("Can not access image data");return u}});var pt,or,ir,ar,sr,ur=U(()=>{"use strict";Xe();pt=(o,r)=>{if(o===void 0)throw new Error("Image buffer must be defined");if(r.height===void 0||r.width===void 0)throw new Error("Image height and width must be defined");if(r.tensorLayout==="NHWC")throw new Error("NHWC Tensor layout is not supported yet");let{height:n,width:u}=r,s=r.norm??{mean:255,bias:0},p,f;typeof s.mean=="number"?p=[s.mean,s.mean,s.mean,s.mean]:p=[s.mean[0],s.mean[1],s.mean[2],s.mean[3]??255],typeof s.bias=="number"?f=[s.bias,s.bias,s.bias,s.bias]:f=[s.bias[0],s.bias[1],s.bias[2],s.bias[3]??0];let m=r.format!==void 0?r.format:"RGBA",h=r.tensorFormat!==void 0&&r.tensorFormat!==void 0?r.tensorFormat:"RGB",l=n*u,y=h==="RGBA"?new Float32Array(l*4):new Float32Array(l*3),b=4,w=0,E=1,x=2,I=3,M=0,B=l,L=l*2,j=-1;m==="RGB"&&(b=3,w=0,E=1,x=2,I=-1),h==="RGBA"?j=l*3:h==="RBG"?(M=0,L=l,B=l*2):h==="BGR"&&(L=0,B=l,M=l*2);for(let R=0;R<l;R++,w+=b,x+=b,E+=b,I+=b)y[M++]=(o[w]+f[0])/p[0],y[B++]=(o[E]+f[1])/p[1],y[L++]=(o[x]+f[2])/p[2],j!==-1&&I!==-1&&(y[j++]=(o[I]+f[3])/p[3]);return h==="RGBA"?new J("float32",y,[1,4,n,u]):new J("float32",y,[1,3,n,u])},or=async(o,r)=>{let n=typeof HTMLImageElement<"u"&&o instanceof HTMLImageElement,u=typeof ImageData<"u"&&o instanceof ImageData,s=typeof ImageBitmap<"u"&&o instanceof ImageBitmap,p=typeof o=="string",f,m=r??{};if(n){let h=document.createElement("canvas");h.width=o.width,h.height=o.height;let l=h.getContext("2d");if(l!=null){let y=o.height,b=o.width;if(r!==void 0&&r.resizedHeight!==void 0&&r.resizedWidth!==void 0&&(y=r.resizedHeight,b=r.resizedWidth),r!==void 0){if(m=r,r.tensorFormat!==void 0)throw new Error("Image input config format must be RGBA for HTMLImageElement");m.tensorFormat="RGBA",m.height=y,m.width=b}else m.tensorFormat="RGBA",m.height=y,m.width=b;l.drawImage(o,0,0),f=l.getImageData(0,0,b,y).data}else throw new Error("Can not access image data")}else if(u){let h,l;if(r!==void 0&&r.resizedWidth!==void 0&&r.resizedHeight!==void 0?(h=r.resizedHeight,l=r.resizedWidth):(h=o.height,l=o.width),r!==void 0&&(m=r),m.format="RGBA",m.height=h,m.width=l,r!==void 0){let y=document.createElement("canvas");y.width=l,y.height=h;let b=y.getContext("2d");if(b!=null)b.putImageData(o,0,0),f=b.getImageData(0,0,l,h).data;else throw new Error("Can not access image data")}else f=o.data}else if(s){if(r===void 0)throw new Error("Please provide image config with format for Imagebitmap");let h=document.createElement("canvas");h.width=o.width,h.height=o.height;let l=h.getContext("2d");if(l!=null){let y=o.height,b=o.width;return l.drawImage(o,0,0,b,y),f=l.getImageData(0,0,b,y).data,m.height=y,m.width=b,pt(f,m)}else throw new Error("Can not access image data")}else{if(p)return new Promise((h,l)=>{let y=document.createElement("canvas"),b=y.getContext("2d");if(!o||!b)return l();let w=new Image;w.crossOrigin="Anonymous",w.src=o,w.onload=()=>{y.width=w.width,y.height=w.height,b.drawImage(w,0,0,y.width,y.height);let E=b.getImageData(0,0,y.width,y.height);m.height=y.height,m.width=y.width,h(pt(E.data,m))}});throw new Error("Input data provided is not supported - aborted tensor creation")}if(f!==void 0)return pt(f,m);throw new Error("Input data provided is not supported - aborted tensor creation")},ir=(o,r)=>{let{width:n,height:u,download:s,dispose:p}=r,f=[1,u,n,4];return new J({location:"texture",type:"float32",texture:o,dims:f,download:s,dispose:p})},ar=(o,r)=>{let{dataType:n,dims:u,download:s,dispose:p}=r;return new J({location:"gpu-buffer",type:n??"float32",gpuBuffer:o,dims:u,download:s,dispose:p})},sr=(o,r,n)=>new J({location:"cpu-pinned",type:o,data:r,dims:n??[r.length]})});var Ie,Je,fr,cr,lr=U(()=>{"use strict";Ie=new Map([["float32",Float32Array],["uint8",Uint8Array],["int8",Int8Array],["uint16",Uint16Array],["float16",Uint16Array],["int16",Int16Array],["int32",Int32Array],["bool",Uint8Array],["float64",Float64Array],["uint32",Uint32Array]]),Je=new Map([[Float32Array,"float32"],[Uint8Array,"uint8"],[Int8Array,"int8"],[Uint16Array,"uint16"],[Int16Array,"int16"],[Int32Array,"int32"],[Float64Array,"float64"],[Uint32Array,"uint32"]]),fr=!1,cr=()=>{if(!fr){fr=!0;let o=typeof BigInt64Array<"u"&&typeof BigInt64Array.from=="function",r=typeof BigUint64Array<"u"&&typeof BigUint64Array.from=="function";o&&(Ie.set("int64",BigInt64Array),Je.set(BigInt64Array,"int64")),r&&(Ie.set("uint64",BigUint64Array),Je.set(BigUint64Array,"uint64"))}}});var dr,pr,mr=U(()=>{"use strict";Xe();dr=o=>{let r=1;for(let n=0;n<o.length;n++){let u=o[n];if(typeof u!="number"||!Number.isSafeInteger(u))throw new TypeError(`dims[${n}] must be an integer, got: ${u}`);if(u<0)throw new RangeError(`dims[${n}] must be a non-negative integer, got: ${u}`);r*=u}return r},pr=(o,r)=>{switch(o.location){case"cpu":return new J(o.type,o.data,r);case"cpu-pinned":return new J({location:"cpu-pinned",data:o.data,type:o.type,dims:r});case"texture":return new J({location:"texture",texture:o.texture,type:o.type,dims:r});case"gpu-buffer":return new J({location:"gpu-buffer",gpuBuffer:o.gpuBuffer,type:o.type,dims:r});default:throw new Error(`tensorReshape: tensor location ${o.location} is not supported`)}}});var J,Xe=U(()=>{"use strict";nr();ur();lr();mr();J=class{constructor(r,n,u){cr();let s,p;if(typeof r=="object"&&"location"in r)switch(this.dataLocation=r.location,s=r.type,p=r.dims,r.location){case"cpu-pinned":{let m=Ie.get(s);if(!m)throw new TypeError(`unsupported type "${s}" to create tensor from pinned buffer`);if(!(r.data instanceof m))throw new TypeError(`buffer should be of type ${m.name}`);this.cpuData=r.data;break}case"texture":{if(s!=="float32")throw new TypeError(`unsupported type "${s}" to create tensor from texture`);this.gpuTextureData=r.texture,this.downloader=r.download,this.disposer=r.dispose;break}case"gpu-buffer":{if(s!=="float32"&&s!=="float16"&&s!=="int32"&&s!=="int64"&&s!=="uint32"&&s!=="bool")throw new TypeError(`unsupported type "${s}" to create tensor from gpu buffer`);this.gpuBufferData=r.gpuBuffer,this.downloader=r.download,this.disposer=r.dispose;break}default:throw new Error(`Tensor constructor: unsupported location '${this.dataLocation}'`)}else{let m,h;if(typeof r=="string")if(s=r,h=u,r==="string"){if(!Array.isArray(n))throw new TypeError("A string tensor's data must be a string array.");m=n}else{let l=Ie.get(r);if(l===void 0)throw new TypeError(`Unsupported tensor type: ${r}.`);if(Array.isArray(n)){if(r==="float16")throw new TypeError("Creating a float16 tensor from number array is not supported. Please use Uint16Array as data.");r==="uint64"||r==="int64"?m=l.from(n,BigInt):m=l.from(n)}else if(n instanceof l)m=n;else throw new TypeError(`A ${s} tensor's data must be type of ${l}`)}else if(h=n,Array.isArray(r)){if(r.length===0)throw new TypeError("Tensor type cannot be inferred from an empty array.");let l=typeof r[0];if(l==="string")s="string",m=r;else if(l==="boolean")s="bool",m=Uint8Array.from(r);else throw new TypeError(`Invalid element type of data array: ${l}.`)}else{let l=Je.get(r.constructor);if(l===void 0)throw new TypeError(`Unsupported type for tensor data: ${r.constructor}.`);s=l,m=r}if(h===void 0)h=[m.length];else if(!Array.isArray(h))throw new TypeError("A tensor's dims must be a number array");p=h,this.cpuData=m,this.dataLocation="cpu"}let f=dr(p);if(this.cpuData&&f!==this.cpuData.length)throw new Error(`Tensor's size(${f}) does not match data length(${this.cpuData.length}).`);this.type=s,this.dims=p,this.size=f}static async fromImage(r,n){return or(r,n)}static fromTexture(r,n){return ir(r,n)}static fromGpuBuffer(r,n){return ar(r,n)}static fromPinnedBuffer(r,n,u){return sr(r,n,u)}toDataURL(r){return tr(this,r)}toImageData(r){return rr(this,r)}get data(){if(this.ensureValid(),!this.cpuData)throw new Error("The data is not on CPU. Use `getData()` to download GPU data to CPU, or use `texture` or `gpuBuffer` property to access the GPU data directly.");return this.cpuData}get location(){return this.dataLocation}get texture(){if(this.ensureValid(),!this.gpuTextureData)throw new Error("The data is not stored as a WebGL texture.");return this.gpuTextureData}get gpuBuffer(){if(this.ensureValid(),!this.gpuBufferData)throw new Error("The data is not stored as a WebGPU buffer.");return this.gpuBufferData}async getData(r){switch(this.ensureValid(),this.dataLocation){case"cpu":case"cpu-pinned":return this.data;case"texture":case"gpu-buffer":{if(!this.downloader)throw new Error("The current tensor is not created with a specified data downloader.");if(this.isDownloading)throw new Error("The current tensor is being downloaded.");try{this.isDownloading=!0;let n=await this.downloader();return this.downloader=void 0,this.dataLocation="cpu",this.cpuData=n,r&&this.disposer&&(this.disposer(),this.disposer=void 0),n}finally{this.isDownloading=!1}}default:throw new Error(`cannot get data from location: ${this.dataLocation}`)}}dispose(){if(this.isDownloading)throw new Error("The current tensor is being downloaded.");this.disposer&&(this.disposer(),this.disposer=void 0),this.cpuData=void 0,this.gpuTextureData=void 0,this.gpuBufferData=void 0,this.downloader=void 0,this.isDownloading=void 0,this.dataLocation="none"}ensureValid(){if(this.dataLocation==="none")throw new Error("The tensor is disposed.")}reshape(r){if(this.ensureValid(),this.downloader||this.disposer)throw new Error("Cannot reshape a tensor that owns GPU resource.");return pr(this,r)}}});var V,Ze=U(()=>{"use strict";Xe();V=J});var Ke,hr=U(()=>{"use strict";qe();Ze();Ke=class o{constructor(r){this.handler=r}async run(r,n,u){let s={},p={};if(typeof r!="object"||r===null||r instanceof V||Array.isArray(r))throw new TypeError("'feeds' must be an object that use input names as keys and OnnxValue as corresponding values.");let f=!0;if(typeof n=="object"){if(n===null)throw new TypeError("Unexpected argument[1]: cannot be null.");if(n instanceof V)throw new TypeError("'fetches' cannot be a Tensor");if(Array.isArray(n)){if(n.length===0)throw new TypeError("'fetches' cannot be an empty array.");f=!1;for(let l of n){if(typeof l!="string")throw new TypeError("'fetches' must be a string array or an object.");if(this.outputNames.indexOf(l)===-1)throw new RangeError(`'fetches' contains invalid output name: ${l}.`);s[l]=null}if(typeof u=="object"&&u!==null)p=u;else if(typeof u<"u")throw new TypeError("'options' must be an object.")}else{let l=!1,y=Object.getOwnPropertyNames(n);for(let b of this.outputNames)if(y.indexOf(b)!==-1){let w=n[b];(w===null||w instanceof V)&&(l=!0,f=!1,s[b]=w)}if(l){if(typeof u=="object"&&u!==null)p=u;else if(typeof u<"u")throw new TypeError("'options' must be an object.")}else p=n}}else if(typeof n<"u")throw new TypeError("Unexpected argument[1]: must be 'fetches' or 'options'.");for(let l of this.inputNames)if(typeof r[l]>"u")throw new Error(`input '${l}' is missing in 'feeds'.`);if(f)for(let l of this.outputNames)s[l]=null;let m=await this.handler.run(r,s,p),h={};for(let l in m)if(Object.hasOwnProperty.call(m,l)){let y=m[l];y instanceof V?h[l]=y:h[l]=new V(y.type,y.data,y.dims)}return h}async release(){return this.handler.dispose()}static async create(r,n,u,s){let p,f={};if(typeof r=="string"){if(p=r,typeof n=="object"&&n!==null)f=n;else if(typeof n<"u")throw new TypeError("'options' must be an object.")}else if(r instanceof Uint8Array){if(p=r,typeof n=="object"&&n!==null)f=n;else if(typeof n<"u")throw new TypeError("'options' must be an object.")}else if(r instanceof ArrayBuffer||typeof SharedArrayBuffer<"u"&&r instanceof SharedArrayBuffer){let b=r,w=0,E=r.byteLength;if(typeof n=="object"&&n!==null)f=n;else if(typeof n=="number"){if(w=n,!Number.isSafeInteger(w))throw new RangeError("'byteOffset' must be an integer.");if(w<0||w>=b.byteLength)throw new RangeError(`'byteOffset' is out of range [0, ${b.byteLength}).`);if(E=r.byteLength-w,typeof u=="number"){if(E=u,!Number.isSafeInteger(E))throw new RangeError("'byteLength' must be an integer.");if(E<=0||w+E>b.byteLength)throw new RangeError(`'byteLength' is out of range (0, ${b.byteLength-w}].`);if(typeof s=="object"&&s!==null)f=s;else if(typeof s<"u")throw new TypeError("'options' must be an object.")}else if(typeof u<"u")throw new TypeError("'byteLength' must be a number.")}else if(typeof n<"u")throw new TypeError("'options' must be an object.");p=new Uint8Array(b,w,E)}else throw new TypeError("Unexpected argument[0]: must be 'path' or 'buffer'.");let h=(f.executionProviders||[]).map(b=>typeof b=="string"?b:b.name),y=await(await Ve(h)).createInferenceSessionHandler(p,f);return new o(y)}startProfiling(){this.handler.startProfiling()}endProfiling(){this.handler.endProfiling()}get inputNames(){return this.handler.inputNames}get outputNames(){return this.handler.outputNames}}});var Dn,yr=U(()=>{"use strict";hr();Dn=Ke});var gr=U(()=>{"use strict"});var Un,Qe,wr=U(()=>{"use strict";qe();Ze();Un="Training backend could not be resolved. Make sure you're using the correct configuration & WebAssembly files.",Qe=class o{constructor(r,n,u){this.handler=r,this.hasOptimizerModel=n,this.hasEvalModel=u}get trainingInputNames(){return this.handler.inputNames}get trainingOutputNames(){return this.handler.outputNames}get evalInputNames(){if(this.hasEvalModel)return this.handler.evalInputNames;throw new Error("This training session has no evalModel loaded.")}get evalOutputNames(){if(this.hasEvalModel)return this.handler.evalOutputNames;throw new Error("This training session has no evalModel loaded.")}static async create(r,n){let u=r.evalModel||"",s=r.optimizerModel||"",p=n||{},m=(p.executionProviders||[]).map(l=>typeof l=="string"?l:l.name),h=await Ve(m);if(h.createTrainingSessionHandler){let l=await h.createTrainingSessionHandler(r.checkpointState,r.trainModel,u,s,p);return new o(l,!!r.optimizerModel,!!r.evalModel)}else throw new Error(Un)}typeNarrowingForRunStep(r,n,u,s,p){let f={},m={};if(typeof u!="object"||u===null||u instanceof V||Array.isArray(u))throw new TypeError("'feeds' must be an object that use input names as keys and OnnxValue as corresponding values.");let h=!0;if(typeof s=="object"){if(s===null)throw new TypeError("Unexpected argument[1]: cannot be null.");if(s instanceof V)throw new TypeError("'fetches' cannot be a Tensor");if(Array.isArray(s)){if(s.length===0)throw new TypeError("'fetches' cannot be an empty array.");h=!1;for(let l of s){if(typeof l!="string")throw new TypeError("'fetches' must be a string array or an object.");if(n.indexOf(l)===-1)throw new RangeError(`'fetches' contains invalid output name: ${l}.`);f[l]=null}if(typeof p=="object"&&p!==null)m=p;else if(typeof p<"u")throw new TypeError("'options' must be an object.")}else{let l=!1,y=Object.getOwnPropertyNames(s);for(let b of n)if(y.indexOf(b)!==-1){let w=s[b];(w===null||w instanceof V)&&(l=!0,h=!1,f[b]=w)}if(l){if(typeof p=="object"&&p!==null)m=p;else if(typeof p<"u")throw new TypeError("'options' must be an object.")}else m=s}}else if(typeof s<"u")throw new TypeError("Unexpected argument[1]: must be 'fetches' or 'options'.");for(let l of r)if(typeof u[l]>"u")throw new Error(`input '${l}' is missing in 'feeds'.`);if(h)for(let l of n)f[l]=null;return[f,m]}convertHandlerReturnTypeToMapOfTensors(r){let n={};for(let u in r)if(Object.hasOwnProperty.call(r,u)){let s=r[u];s instanceof V?n[u]=s:n[u]=new V(s.type,s.data,s.dims)}return n}async lazyResetGrad(){await this.handler.lazyResetGrad()}async runTrainStep(r,n,u){let[s,p]=this.typeNarrowingForRunStep(this.trainingInputNames,this.trainingOutputNames,r,n,u),f=await this.handler.runTrainStep(r,s,p);return this.convertHandlerReturnTypeToMapOfTensors(f)}async runOptimizerStep(r){if(this.hasOptimizerModel)await this.handler.runOptimizerStep(r||{});else throw new Error("This TrainingSession has no OptimizerModel loaded.")}async runEvalStep(r,n,u){if(this.hasEvalModel){let[s,p]=this.typeNarrowingForRunStep(this.evalInputNames,this.evalOutputNames,r,n,u),f=await this.handler.runEvalStep(r,s,p);return this.convertHandlerReturnTypeToMapOfTensors(f)}else throw new Error("This TrainingSession has no EvalModel loaded.")}async getParametersSize(r=!0){return this.handler.getParametersSize(r)}async loadParametersBuffer(r,n=!0){let u=await this.getParametersSize(n);if(r.length!==4*u)throw new Error("Size of the buffer passed into loadParametersBuffer must match the number of parameters in the model. Please use getParametersSize method to check.");return this.handler.loadParametersBuffer(r,n)}async getContiguousParameters(r=!0){return this.handler.getContiguousParameters(r)}async release(){return this.handler.dispose()}}});var Mn,br=U(()=>{"use strict";wr();Mn=Qe});var mt={};Ge(mt,{InferenceSession:()=>Dn,Tensor:()=>V,TrainingSession:()=>Mn,env:()=>H,registerBackend:()=>we});var be=U(()=>{"use strict";Xt();er();yr();Ze();gr();br()});var Er={};Ge(Er,{readFile:()=>Ln});var Ln,Tr=U(()=>{Ln=void 0});var Sr={};Ge(Sr,{join:()=>Rn});var Rn,Or=U(()=>{Rn=void 0});var Ir=_n((Pr,ht)=>{"use strict";var Ar=(()=>{var o=typeof document<"u"&&document.currentScript?document.currentScript.src:void 0;return typeof __filename<"u"&&(o=o||__filename),function(r={}){var n=r,u,s;n.ready=new Promise((e,t)=>{u=e,s=t});var p=Object.assign({},n),f="./this.program",m=typeof window=="object",h=typeof importScripts=="function",l=typeof process=="object"&&typeof process.versions=="object"&&typeof process.versions.node=="string",y="",b,w,E;if(l){var x=(Tr(),lt(Er)),I=(Or(),lt(Sr));y=h?I.dirname(y)+"/":__dirname+"/",b=(e,t)=>(e=e.startsWith("file://")?new URL(e):I.normalize(e),x.readFileSync(e,t?void 0:"utf8")),E=e=>(e=b(e,!0),e.buffer||(e=new Uint8Array(e)),e),w=(e,t,i,a=!0)=>{e=e.startsWith("file://")?new URL(e):I.normalize(e),x.readFile(e,a?void 0:"utf8",(c,g)=>{c?i(c):t(a?g.buffer:g)})},!n.thisProgram&&1<process.argv.length&&(f=process.argv[1].replace(/\\/g,"/")),process.argv.slice(2),n.inspect=()=>"[Emscripten Module object]"}else(m||h)&&(h?y=self.location.href:typeof document<"u"&&document.currentScript&&(y=document.currentScript.src),o&&(y=o),y.indexOf("blob:")!==0?y=y.substr(0,y.replace(/[?#].*/,"").lastIndexOf("/")+1):y="",b=e=>{var t=new XMLHttpRequest;return t.open("GET",e,!1),t.send(null),t.responseText},h&&(E=e=>{var t=new XMLHttpRequest;return t.open("GET",e,!1),t.responseType="arraybuffer",t.send(null),new Uint8Array(t.response)}),w=(e,t,i)=>{var a=new XMLHttpRequest;a.open("GET",e,!0),a.responseType="arraybuffer",a.onload=()=>{a.status==200||a.status==0&&a.response?t(a.response):i()},a.onerror=i,a.send(null)});var M=console.log.bind(console),B=console.error.bind(console);Object.assign(n,p),p=null,typeof WebAssembly!="object"&&De("no native wasm support detected");var L,j=!1,z,R,oe,pe,T,_,_e,Ce,Se,ue;function C(){var e=L.buffer;n.HEAP8=z=new Int8Array(e),n.HEAP16=oe=new Int16Array(e),n.HEAPU8=R=new Uint8Array(e),n.HEAPU16=pe=new Uint16Array(e),n.HEAP32=T=new Int32Array(e),n.HEAPU32=_=new Uint32Array(e),n.HEAPF32=_e=new Float32Array(e),n.HEAPF64=ue=new Float64Array(e),n.HEAP64=Ce=new BigInt64Array(e),n.HEAPU64=Se=new BigUint64Array(e)}var fe=[],ve=[],re=[],ne=0,G=null,q=null;function De(e){throw e="Aborted("+e+")",B(e),j=!0,e=new WebAssembly.RuntimeError(e+". Build with -sASSERTIONS for more info."),s(e),e}function me(e){return e.startsWith("data:application/octet-stream;base64,")}var ce;if(ce="ort-wasm.wasm",!me(ce)){var Oe=ce;ce=n.locateFile?n.locateFile(Oe,y):y+Oe}function Ue(e){if(E)return E(e);throw"both async and sync fetching of the wasm failed"}function he(e){if(m||h){if(typeof fetch=="function"&&!e.startsWith("file://"))return fetch(e,{credentials:"same-origin"}).then(t=>{if(!t.ok)throw"failed to load wasm binary file at '"+e+"'";return t.arrayBuffer()}).catch(()=>Ue(e));if(w)return new Promise((t,i)=>{w(e,a=>t(new Uint8Array(a)),i)})}return Promise.resolve().then(()=>Ue(e))}function le(e,t,i){return he(e).then(a=>WebAssembly.instantiate(a,t)).then(a=>a).then(i,a=>{B(`failed to asynchronously prepare wasm: ${a}`),De(a)})}function Me(e,t){var i=ce;return typeof WebAssembly.instantiateStreaming!="function"||me(i)||i.startsWith("file://")||l||typeof fetch!="function"?le(i,e,t):fetch(i,{credentials:"same-origin"}).then(a=>WebAssembly.instantiateStreaming(a,e).then(t,function(c){return B(`wasm streaming compile failed: ${c}`),B("falling back to ArrayBuffer instantiation"),le(i,e,t)}))}function X(e){this.Va=e-24,this.fb=function(t){_[this.Va+4>>>2>>>0]=t},this.eb=function(t){_[this.Va+8>>>2>>>0]=t},this.Za=function(t,i){this.$a(),this.fb(t),this.eb(i)},this.$a=function(){_[this.Va+16>>>2>>>0]=0}}var Y=0,Ae=0,Pe=typeof TextDecoder<"u"?new TextDecoder("utf8"):void 0,Le=(e,t,i)=>{t>>>=0;var a=t+i;for(i=t;e[i]&&!(i>=a);)++i;if(16<i-t&&e.buffer&&Pe)return Pe.decode(e.subarray(t,i));for(a="";t<i;){var c=e[t++];if(c&128){var g=e[t++]&63;if((c&224)==192)a+=String.fromCharCode((c&31)<<6|g);else{var S=e[t++]&63;c=(c&240)==224?(c&15)<<12|g<<6|S:(c&7)<<18|g<<12|S<<6|e[t++]&63,65536>c?a+=String.fromCharCode(c):(c-=65536,a+=String.fromCharCode(55296|c>>10,56320|c&1023))}}else a+=String.fromCharCode(c)}return a},Re=(e,t)=>(e>>>=0)?Le(R,e,t):"",Fe=e=>{for(var t=0,i=0;i<e.length;++i){var a=e.charCodeAt(i);127>=a?t++:2047>=a?t+=2:55296<=a&&57343>=a?(t+=4,++i):t+=3}return t},We=(e,t,i,a)=>{if(i>>>=0,!(0<a))return 0;var c=i;a=i+a-1;for(var g=0;g<e.length;++g){var S=e.charCodeAt(g);if(55296<=S&&57343>=S){var v=e.charCodeAt(++g);S=65536+((S&1023)<<10)|v&1023}if(127>=S){if(i>=a)break;t[i++>>>0]=S}else{if(2047>=S){if(i+1>=a)break;t[i++>>>0]=192|S>>6}else{if(65535>=S){if(i+2>=a)break;t[i++>>>0]=224|S>>12}else{if(i+3>=a)break;t[i++>>>0]=240|S>>18,t[i++>>>0]=128|S>>12&63}t[i++>>>0]=128|S>>6&63}t[i++>>>0]=128|S&63}}return t[i>>>0]=0,i-c},At=e=>{if(e===null)return"null";var t=typeof e;return t==="object"||t==="array"||t==="function"?e.toString():""+e},Pt,te=e=>{for(var t="";R[e>>>0];)t+=Pt[R[e++>>>0]];return t},it={},at={},sn={},de;function un(e,t,i={}){var a=t.name;if(!e)throw new de(`type "${a}" must have a positive integer typeid pointer`);if(at.hasOwnProperty(e)){if(i.gb)return;throw new de(`Cannot register type '${a}' twice`)}at[e]=t,delete sn[e],it.hasOwnProperty(e)&&(t=it[e],delete it[e],t.forEach(c=>c()))}function ie(e,t,i={}){if(!("argPackAdvance"in t))throw new TypeError("registerType registeredInstance requires argPackAdvance");un(e,t,i)}var It=(e,t,i)=>{switch(t){case 1:return i?a=>z[a>>>0>>>0]:a=>R[a>>>0>>>0];case 2:return i?a=>oe[a>>>1>>>0]:a=>pe[a>>>1>>>0];case 4:return i?a=>T[a>>>2>>>0]:a=>_[a>>>2>>>0];case 8:return i?a=>Ce[a>>>3]:a=>Se[a>>>3];default:throw new TypeError(`invalid integer width (${t}): ${e}`)}};function xt(){this.Sa=[void 0],this.bb=[]}var Q=new xt;function st(e){e>>>=0,e>=Q.Va&&--Q.get(e).cb===0&&Q.$a(e)}var Z=e=>{if(!e)throw new de("Cannot use deleted val. handle = "+e);return Q.get(e).value},ee=e=>{switch(e){case void 0:return 1;case null:return 2;case!0:return 3;case!1:return 4;default:return Q.Za({cb:1,value:e})}};function Bt(e){return this.fromWireType(T[e>>>2>>>0])}var fn=(e,t)=>{switch(t){case 4:return function(i){return this.fromWireType(_e[i>>>2>>>0])};case 8:return function(i){return this.fromWireType(ue[i>>>3>>>0])};default:throw new TypeError(`invalid float width (${t}): ${e}`)}};function cn(e){return this.fromWireType(_[e>>>2>>>0])}var _t=typeof TextDecoder<"u"?new TextDecoder("utf-16le"):void 0,ln=(e,t)=>{for(var i=e>>1,a=i+t/2;!(i>=a)&&pe[i>>>0];)++i;if(i<<=1,32<i-e&&_t)return _t.decode(R.subarray(e>>>0,i>>>0));for(i="",a=0;!(a>=t/2);++a){var c=oe[e+2*a>>>1>>>0];if(c==0)break;i+=String.fromCharCode(c)}return i},dn=(e,t,i)=>{if(i===void 0&&(i=2147483647),2>i)return 0;i-=2;var a=t;i=i<2*e.length?i/2:e.length;for(var c=0;c<i;++c)oe[t>>>1>>>0]=e.charCodeAt(c),t+=2;return oe[t>>>1>>>0]=0,t-a},pn=e=>2*e.length,mn=(e,t)=>{for(var i=0,a="";!(i>=t/4);){var c=T[e+4*i>>>2>>>0];if(c==0)break;++i,65536<=c?(c-=65536,a+=String.fromCharCode(55296|c>>10,56320|c&1023)):a+=String.fromCharCode(c)}return a},hn=(e,t,i)=>{if(t>>>=0,i===void 0&&(i=2147483647),4>i)return 0;var a=t;i=a+i-4;for(var c=0;c<e.length;++c){var g=e.charCodeAt(c);if(55296<=g&&57343>=g){var S=e.charCodeAt(++c);g=65536+((g&1023)<<10)|S&1023}if(T[t>>>2>>>0]=g,t+=4,t+4>i)break}return T[t>>>2>>>0]=0,t-a},yn=e=>{for(var t=0,i=0;i<e.length;++i){var a=e.charCodeAt(i);55296<=a&&57343>=a&&++i,t+=4}return t},ke=(e,t)=>{var i=at[e];if(i===void 0)throw e=jt(e),i=te(e),ae(e),new de(t+" has unknown type "+i);return i},gn={},Ne=e=>{var t=gn[e];return t===void 0?te(e):t},$e=[],Ct=()=>typeof globalThis=="object"?globalThis:Function("return this")(),wn=e=>{var t=$e.length;return $e.push(e),t},bn=(e,t)=>{for(var i=Array(e),a=0;a<e;++a)i[a]=ke(_[t+4*a>>>2>>>0],"parameter "+a);return i},Dt=e=>{if(e===void 0)return"_unknown";e=e.replace(/[^a-zA-Z0-9_]/g,"$");var t=e.charCodeAt(0);return 48<=t&&57>=t?`_${e}`:e},Ut={};function vn(e,t){return e=Dt(e),{[e]:function(){return t.apply(this,arguments)}}[e]}function En(e){var t=Function;if(!(t instanceof Function))throw new TypeError(`new_ called with constructor type ${typeof t} which is not a function`);var i=vn(t.name||"unknownFunctionName",function(){});return i.prototype=t.prototype,i=new i,e=t.apply(i,e),e instanceof Object?e:i}var Tn=e=>{for(var t="",i=0;i<e;++i)t+=(i!==0?", ":"")+"arg"+i;var a="return function emval_allocator_"+e+`(constructor, argTypes, args) {
  var HEAPU32 = getMemory();
`;for(i=0;i<e;++i)a+="var argType"+i+" = requireRegisteredType(HEAPU32[((argTypes)>>>2)], 'parameter "+i+`');
var arg`+i+" = argType"+i+`.readValueFromPointer(args);
args += argType`+i+`['argPackAdvance'];
argTypes += 4;
`;return new Function("requireRegisteredType","Module","valueToHandle","getMemory",a+("var obj = new constructor("+t+`);
return valueToHandle(obj);
}
`))(ke,n,ee,()=>_)},Mt={},Ee=e=>e%4===0&&(e%100!==0||e%400===0),Lt=[0,31,60,91,121,152,182,213,244,274,305,335],Rt=[0,31,59,90,120,151,181,212,243,273,304,334],Ft=e=>{var t=Fe(e)+1,i=je(t);return i&&We(e,R,i,t),i},ut={},Wt=()=>{if(!ft){var e={USER:"web_user",LOGNAME:"web_user",PATH:"/",PWD:"/",HOME:"/home/web_user",LANG:(typeof navigator=="object"&&navigator.languages&&navigator.languages[0]||"C").replace("-","_")+".UTF-8",_:f||"./this.program"},t;for(t in ut)ut[t]===void 0?delete e[t]:e[t]=ut[t];var i=[];for(t in e)i.push(`${t}=${e[t]}`);ft=i}return ft},ft,Sn=[null,[],[]],kt=[31,29,31,30,31,30,31,31,30,31,30,31],Nt=[31,28,31,30,31,30,31,31,30,31,30,31];function On(e){var t=Array(Fe(e)+1);return We(e,t,0,t.length),t}function $t(e,t,i,a){function c(d,D,W){for(d=typeof d=="number"?d.toString():d||"";d.length<D;)d=W[0]+d;return d}function g(d,D){return c(d,D,"0")}function S(d,D){function W(qt){return 0>qt?-1:0<qt?1:0}var ye;return(ye=W(d.getFullYear()-D.getFullYear()))===0&&(ye=W(d.getMonth()-D.getMonth()))===0&&(ye=W(d.getDate()-D.getDate())),ye}function v(d){switch(d.getDay()){case 0:return new Date(d.getFullYear()-1,11,29);case 1:return d;case 2:return new Date(d.getFullYear(),0,3);case 3:return new Date(d.getFullYear(),0,2);case 4:return new Date(d.getFullYear(),0,1);case 5:return new Date(d.getFullYear()-1,11,31);case 6:return new Date(d.getFullYear()-1,11,30)}}function O(d){var D=d.Ta;for(d=new Date(new Date(d.Ua+1900,0,1).getTime());0<D;){var W=d.getMonth(),ye=(Ee(d.getFullYear())?kt:Nt)[W];if(D>ye-d.getDate())D-=ye-d.getDate()+1,d.setDate(1),11>W?d.setMonth(W+1):(d.setMonth(0),d.setFullYear(d.getFullYear()+1));else{d.setDate(d.getDate()+D);break}}return W=new Date(d.getFullYear()+1,0,4),D=v(new Date(d.getFullYear(),0,4)),W=v(W),0>=S(D,d)?0>=S(W,d)?d.getFullYear()+1:d.getFullYear():d.getFullYear()-1}e>>>=0,t>>>=0,i>>>=0,a>>>=0;var P=_[a+40>>>2>>>0];a={kb:T[a>>>2>>>0],jb:T[a+4>>>2>>>0],Xa:T[a+8>>>2>>>0],ab:T[a+12>>>2>>>0],Ya:T[a+16>>>2>>>0],Ua:T[a+20>>>2>>>0],Oa:T[a+24>>>2>>>0],Ta:T[a+28>>>2>>>0],mb:T[a+32>>>2>>>0],ib:T[a+36>>>2>>>0],lb:P?Re(P):""},i=Re(i),P={"%c":"%a %b %d %H:%M:%S %Y","%D":"%m/%d/%y","%F":"%Y-%m-%d","%h":"%b","%r":"%I:%M:%S %p","%R":"%H:%M","%T":"%H:%M:%S","%x":"%m/%d/%y","%X":"%H:%M:%S","%Ec":"%c","%EC":"%C","%Ex":"%m/%d/%y","%EX":"%H:%M:%S","%Ey":"%y","%EY":"%Y","%Od":"%d","%Oe":"%e","%OH":"%H","%OI":"%I","%Om":"%m","%OM":"%M","%OS":"%S","%Ou":"%u","%OU":"%U","%OV":"%V","%Ow":"%w","%OW":"%W","%Oy":"%y"};for(var F in P)i=i.replace(new RegExp(F,"g"),P[F]);var K="Sunday Monday Tuesday Wednesday Thursday Friday Saturday".split(" "),se="January February March April May June July August September October November December".split(" ");P={"%a":d=>K[d.Oa].substring(0,3),"%A":d=>K[d.Oa],"%b":d=>se[d.Ya].substring(0,3),"%B":d=>se[d.Ya],"%C":d=>g((d.Ua+1900)/100|0,2),"%d":d=>g(d.ab,2),"%e":d=>c(d.ab,2," "),"%g":d=>O(d).toString().substring(2),"%G":d=>O(d),"%H":d=>g(d.Xa,2),"%I":d=>(d=d.Xa,d==0?d=12:12<d&&(d-=12),g(d,2)),"%j":d=>{for(var D=0,W=0;W<=d.Ya-1;D+=(Ee(d.Ua+1900)?kt:Nt)[W++]);return g(d.ab+D,3)},"%m":d=>g(d.Ya+1,2),"%M":d=>g(d.jb,2),"%n":()=>`
`,"%p":d=>0<=d.Xa&&12>d.Xa?"AM":"PM","%S":d=>g(d.kb,2),"%t":()=>"	","%u":d=>d.Oa||7,"%U":d=>g(Math.floor((d.Ta+7-d.Oa)/7),2),"%V":d=>{var D=Math.floor((d.Ta+7-(d.Oa+6)%7)/7);if(2>=(d.Oa+371-d.Ta-2)%7&&D++,D)D==53&&(W=(d.Oa+371-d.Ta)%7,W==4||W==3&&Ee(d.Ua)||(D=1));else{D=52;var W=(d.Oa+7-d.Ta-1)%7;(W==4||W==5&&Ee(d.Ua%400-1))&&D++}return g(D,2)},"%w":d=>d.Oa,"%W":d=>g(Math.floor((d.Ta+7-(d.Oa+6)%7)/7),2),"%y":d=>(d.Ua+1900).toString().substring(2),"%Y":d=>d.Ua+1900,"%z":d=>{d=d.ib;var D=0<=d;return d=Math.abs(d)/60,(D?"+":"-")+("0000"+(d/60*100+d%60)).slice(-4)},"%Z":d=>d.lb,"%%":()=>"%"},i=i.replace(/%%/g,"\0\0");for(F in P)i.includes(F)&&(i=i.replace(new RegExp(F,"g"),P[F](a)));return i=i.replace(/\0\0/g,"%"),F=On(i),F.length>t?0:(z.set(F,e>>>0),F.length-1)}for(var Ht=Array(256),He=0;256>He;++He)Ht[He]=String.fromCharCode(He);Pt=Ht,de=n.BindingError=class extends Error{constructor(e){super(e),this.name="BindingError"}},n.InternalError=class extends Error{constructor(e){super(e),this.name="InternalError"}},Object.assign(xt.prototype,{get(e){return this.Sa[e]},has(e){return this.Sa[e]!==void 0},Za(e){var t=this.bb.pop()||this.Sa.length;return this.Sa[t]=e,t},$a(e){this.Sa[e]=void 0,this.bb.push(e)}}),Q.Sa.push({value:void 0},{value:null},{value:!0},{value:!1}),Q.Va=Q.Sa.length,n.count_emval_handles=()=>{for(var e=0,t=Q.Va;t<Q.Sa.length;++t)Q.Sa[t]!==void 0&&++e;return e};var An={a:function(e,t,i){throw e>>>=0,new X(e).Za(t>>>0,i>>>0),Y=e,Ae++,Y},v:function(){return 0},ba:function(){},N:function(){},P:function(){},H:function(){return 0},$:function(){},V:function(){},_:function(){},B:function(){},O:function(){},L:function(){},aa:function(){},M:function(){},E:function(e,t,i,a,c){t>>>=0,t=te(t);var g=t.indexOf("u")!=-1;g&&(c=(1n<<64n)-1n),ie(e>>>0,{name:t,fromWireType:S=>S,toWireType:function(S,v){if(typeof v!="bigint"&&typeof v!="number")throw new TypeError(`Cannot convert "${At(v)}" to ${this.name}`);if(v<a||v>c)throw new TypeError(`Passing a number "${At(v)}" from JS side to C/C++ side to an argument of type "${t}", which is outside the valid range [${a}, ${c}]!`);return v},argPackAdvance:8,readValueFromPointer:It(t,i>>>0,!g),Wa:null})},ea:function(e,t,i,a){t=te(t>>>0),ie(e>>>0,{name:t,fromWireType:function(c){return!!c},toWireType:function(c,g){return g?i:a},argPackAdvance:8,readValueFromPointer:function(c){return this.fromWireType(R[c>>>0])},Wa:null})},da:function(e,t){t=te(t>>>0),ie(e>>>0,{name:t,fromWireType:i=>{var a=Z(i);return st(i),a},toWireType:(i,a)=>ee(a),argPackAdvance:8,readValueFromPointer:Bt,Wa:null})},D:function(e,t,i){t=te(t>>>0),ie(e>>>0,{name:t,fromWireType:a=>a,toWireType:(a,c)=>c,argPackAdvance:8,readValueFromPointer:fn(t,i>>>0),Wa:null})},p:function(e,t,i,a,c){if(e>>>=0,i>>>=0,t=te(t>>>0),c===-1&&(c=4294967295),c=v=>v,a===0){var g=32-8*i;c=v=>v<<g>>>g}var S=t.includes("unsigned")?function(v,O){return O>>>0}:function(v,O){return O};ie(e,{name:t,fromWireType:c,toWireType:S,argPackAdvance:8,readValueFromPointer:It(t,i,a!==0),Wa:null})},l:function(e,t,i){function a(g){return new c(z.buffer,_[g+4>>>2>>>0],_[g>>>2>>>0])}var c=[Int8Array,Uint8Array,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array,BigInt64Array,BigUint64Array][t];i=te(i>>>0),ie(e>>>0,{name:i,fromWireType:a,argPackAdvance:8,readValueFromPointer:a},{gb:!0})},F:function(e,t){t=te(t>>>0);var i=t==="std::string";ie(e>>>0,{name:t,fromWireType:function(a){var c=_[a>>>2>>>0],g=a+4;if(i)for(var S=g,v=0;v<=c;++v){var O=g+v;if(v==c||R[O>>>0]==0){if(S=Re(S,O-S),P===void 0)var P=S;else P+=String.fromCharCode(0),P+=S;S=O+1}}else{for(P=Array(c),v=0;v<c;++v)P[v]=String.fromCharCode(R[g+v>>>0]);P=P.join("")}return ae(a),P},toWireType:function(a,c){c instanceof ArrayBuffer&&(c=new Uint8Array(c));var g=typeof c=="string";if(!(g||c instanceof Uint8Array||c instanceof Uint8ClampedArray||c instanceof Int8Array))throw new de("Cannot pass non-string to std::string");var S=i&&g?Fe(c):c.length,v=je(4+S+1),O=v+4;if(_[v>>>2>>>0]=S,i&&g)We(c,R,O,S+1);else if(g)for(g=0;g<S;++g){var P=c.charCodeAt(g);if(255<P)throw ae(O),new de("String has UTF-16 code units that do not fit in 8 bits");R[O+g>>>0]=P}else for(g=0;g<S;++g)R[O+g>>>0]=c[g];return a!==null&&a.push(ae,v),v},argPackAdvance:8,readValueFromPointer:cn,Wa(a){ae(a)}})},x:function(e,t,i){if(t>>>=0,i>>>=0,i=te(i),t===2)var a=ln,c=dn,g=pn,S=()=>pe,v=1;else t===4&&(a=mn,c=hn,g=yn,S=()=>_,v=2);ie(e>>>0,{name:i,fromWireType:O=>{for(var P=_[O>>>2>>>0],F=S(),K,se=O+4,d=0;d<=P;++d){var D=O+4+d*t;(d==P||F[D>>>v]==0)&&(se=a(se,D-se),K===void 0?K=se:(K+=String.fromCharCode(0),K+=se),se=D+t)}return ae(O),K},toWireType:(O,P)=>{if(typeof P!="string")throw new de(`Cannot pass non-string to C++ string type ${i}`);var F=g(P),K=je(4+F+t);return _[K>>>2]=F>>v,c(P,K+4,F+t),O!==null&&O.push(ae,K),K},argPackAdvance:8,readValueFromPointer:Bt,Wa(O){ae(O)}})},fa:function(e,t){t=te(t>>>0),ie(e>>>0,{hb:!0,name:t,argPackAdvance:0,fromWireType:()=>{},toWireType:()=>{}})},ca:()=>!0,o:function(e,t,i){t>>>=0,i>>>=0,e=Z(e>>>0),t=ke(t,"emval::as");var a=[],c=ee(a);return _[i>>>2>>>0]=c,t.toWireType(a,e)},h:function(e,t,i,a,c){i>>>=0,a>>>=0,c>>>=0,e=$e[e>>>0],t=Z(t>>>0),i=Ne(i);var g=[];return _[a>>>2>>>0]=ee(g),e(t,i,g,c)},r:function(e,t,i,a){i>>>=0,a>>>=0,e=$e[e>>>0],t=Z(t>>>0),i=Ne(i),e(t,i,null,a)},b:st,y:function(e,t){return t>>>=0,e=Z(e>>>0),t=Z(t),e==t},u:function(e){return e>>>=0,e===0?ee(Ct()):(e=Ne(e),ee(Ct()[e]))},g:function(e,t){var i=bn(e,t>>>0),a=i[0];t=a.name+"_$"+i.slice(1).map(function(F){return F.name}).join("_")+"$";var c=Ut[t];if(c!==void 0)return c;c=["retType"];for(var g=[a],S="",v=0;v<e-1;++v)S+=(v!==0?", ":"")+"arg"+v,c.push("argType"+v),g.push(i[1+v]);var O="return function "+Dt("methodCaller_"+t)+`(handle, name, destructors, args) {
`,P=0;for(v=0;v<e-1;++v)O+="    var arg"+v+" = argType"+v+".readValueFromPointer(args"+(P?"+"+P:"")+`);
`,P+=i[v+1].argPackAdvance;for(O+="    var rv = handle[name]("+S+`);
`,v=0;v<e-1;++v)i[v+1].deleteObject&&(O+="    argType"+v+".deleteObject(arg"+v+`);
`);return a.hb||(O+=`    return retType.toWireType(destructors, rv);
`),c.push(O+`};
`),e=En(c).apply(null,g),c=wn(e),Ut[t]=c},q:function(e,t){return t>>>=0,e=Z(e>>>0),t=Z(t),ee(e[t])},c:function(e){e>>>=0,4<e&&(Q.get(e).cb+=1)},G:function(e,t,i,a){i>>>=0,a>>>=0,e=Z(e>>>0);var c=Mt[t];return c||(c=Tn(t),Mt[t]=c),c(e,i,a)},s:function(){return ee([])},k:function(e){e=Z(e>>>0);for(var t=Array(e.length),i=0;i<e.length;i++)t[i]=e[i];return ee(t)},d:function(e){return ee(Ne(e>>>0))},j:function(){return ee({})},e:function(e){e>>>=0;for(var t=Z(e);t.length;){var i=t.pop();t.pop()(i)}st(e)},i:function(e,t,i){t>>>=0,i>>>=0,e=Z(e>>>0),t=Z(t),i=Z(i),e[t]=i},f:function(e,t){return t>>>=0,e=ke(e>>>0,"_emval_take_value"),e=e.readValueFromPointer(t),ee(e)},S:function(e,t){e=-9007199254740992>e||9007199254740992<e?NaN:Number(e),t>>>=0,e=new Date(1e3*e),T[t>>>2>>>0]=e.getUTCSeconds(),T[t+4>>>2>>>0]=e.getUTCMinutes(),T[t+8>>>2>>>0]=e.getUTCHours(),T[t+12>>>2>>>0]=e.getUTCDate(),T[t+16>>>2>>>0]=e.getUTCMonth(),T[t+20>>>2>>>0]=e.getUTCFullYear()-1900,T[t+24>>>2>>>0]=e.getUTCDay(),T[t+28>>>2>>>0]=(e.getTime()-Date.UTC(e.getUTCFullYear(),0,1,0,0,0,0))/864e5|0},T:function(e,t){e=-9007199254740992>e||9007199254740992<e?NaN:Number(e),t>>>=0,e=new Date(1e3*e),T[t>>>2>>>0]=e.getSeconds(),T[t+4>>>2>>>0]=e.getMinutes(),T[t+8>>>2>>>0]=e.getHours(),T[t+12>>>2>>>0]=e.getDate(),T[t+16>>>2>>>0]=e.getMonth(),T[t+20>>>2>>>0]=e.getFullYear()-1900,T[t+24>>>2>>>0]=e.getDay(),T[t+28>>>2>>>0]=(Ee(e.getFullYear())?Lt:Rt)[e.getMonth()]+e.getDate()-1|0,T[t+36>>>2>>>0]=-(60*e.getTimezoneOffset());var i=new Date(e.getFullYear(),6,1).getTimezoneOffset(),a=new Date(e.getFullYear(),0,1).getTimezoneOffset();T[t+32>>>2>>>0]=(i!=a&&e.getTimezoneOffset()==Math.min(a,i))|0},U:function(e){e>>>=0;var t=new Date(T[e+20>>>2>>>0]+1900,T[e+16>>>2>>>0],T[e+12>>>2>>>0],T[e+8>>>2>>>0],T[e+4>>>2>>>0],T[e>>>2>>>0],0),i=T[e+32>>>2>>>0],a=t.getTimezoneOffset(),c=new Date(t.getFullYear(),6,1).getTimezoneOffset(),g=new Date(t.getFullYear(),0,1).getTimezoneOffset(),S=Math.min(g,c);return 0>i?T[e+32>>>2>>>0]=+(c!=g&&S==a):0<i!=(S==a)&&(c=Math.max(g,c),t.setTime(t.getTime()+6e4*((0<i?S:c)-a))),T[e+24>>>2>>>0]=t.getDay(),T[e+28>>>2>>>0]=(Ee(t.getFullYear())?Lt:Rt)[t.getMonth()]+t.getDate()-1|0,T[e>>>2>>>0]=t.getSeconds(),T[e+4>>>2>>>0]=t.getMinutes(),T[e+8>>>2>>>0]=t.getHours(),T[e+12>>>2>>>0]=t.getDate(),T[e+16>>>2>>>0]=t.getMonth(),T[e+20>>>2>>>0]=t.getYear(),BigInt(t.getTime()/1e3)},Q:function(){return-52},R:function(){},J:function(e,t,i){function a(O){return(O=O.toTimeString().match(/\(([A-Za-z ]+)\)$/))?O[1]:"GMT"}i>>>=0;var c=new Date().getFullYear(),g=new Date(c,0,1),S=new Date(c,6,1);c=g.getTimezoneOffset();var v=S.getTimezoneOffset();_[e>>>0>>>2>>>0]=60*Math.max(c,v),T[t>>>0>>>2>>>0]=+(c!=v),e=a(g),t=a(S),e=Ft(e),t=Ft(t),v<c?(_[i>>>2>>>0]=e,_[i+4>>>2>>>0]=t):(_[i>>>2>>>0]=t,_[i+4>>>2>>>0]=e)},t:()=>{De("")},C:()=>Date.now(),K:function(){return 4294901760},n:()=>performance.now(),Z:function(e,t,i){return t>>>=0,R.copyWithin(e>>>0>>>0,t>>>0,t+(i>>>0)>>>0)},I:function(e){e>>>=0;var t=R.length;if(4294901760<e)return!1;for(var i=1;4>=i;i*=2){var a=t*(1+.2/i);a=Math.min(a,e+100663296);var c=Math;a=Math.max(e,a);e:{c=(c.min.call(c,4294901760,a+(65536-a%65536)%65536)-L.buffer.byteLength+65535)/65536;try{L.grow(c),C();var g=1;break e}catch{}g=void 0}if(g)return!0}return!1},X:function(e,t){e>>>=0,t>>>=0;var i=0;return Wt().forEach((a,c)=>{var g=t+i;for(c=_[e+4*c>>>2>>>0]=g,g=0;g<a.length;++g)z[c++>>>0>>>0]=a.charCodeAt(g);z[c>>>0>>>0]=0,i+=a.length+1}),0},Y:function(e,t){e>>>=0,t>>>=0;var i=Wt();_[e>>>2>>>0]=i.length;var a=0;return i.forEach(c=>a+=c.length+1),_[t>>>2>>>0]=a,0},w:()=>52,A:function(){return 52},W:function(){return 70},z:function(e,t,i,a){t>>>=0,i>>>=0,a>>>=0;for(var c=0,g=0;g<i;g++){var S=_[t>>>2>>>0],v=_[t+4>>>2>>>0];t+=8;for(var O=0;O<v;O++){var P=R[S+O>>>0],F=Sn[e];P===0||P===10?((e===1?M:B)(Le(F,0)),F.length=0):F.push(P)}c+=v}return _[a>>>2>>>0]=c,0},ga:$t,m:function(e,t,i,a){return $t(e>>>0,t>>>0,i>>>0,a>>>0)}},A=function(){var e={a:An};return ne++,Me(e,function(t){A=t.instance.exports,A=Pn(),L=A.ha,C(),ve.unshift(A.ia),ne--,ne==0&&(G!==null&&(clearInterval(G),G=null),q&&(t=q,q=null,t()))}).catch(s),{}}();n._OrtInit=(e,t)=>(n._OrtInit=A.ja)(e,t),n._OrtGetLastError=(e,t)=>(n._OrtGetLastError=A.ka)(e,t),n._OrtCreateSessionOptions=(e,t,i,a,c,g,S,v,O,P)=>(n._OrtCreateSessionOptions=A.la)(e,t,i,a,c,g,S,v,O,P),n._OrtAppendExecutionProvider=(e,t)=>(n._OrtAppendExecutionProvider=A.ma)(e,t),n._OrtAddFreeDimensionOverride=(e,t,i)=>(n._OrtAddFreeDimensionOverride=A.na)(e,t,i),n._OrtAddSessionConfigEntry=(e,t,i)=>(n._OrtAddSessionConfigEntry=A.oa)(e,t,i),n._OrtReleaseSessionOptions=e=>(n._OrtReleaseSessionOptions=A.pa)(e),n._OrtCreateSession=(e,t,i)=>(n._OrtCreateSession=A.qa)(e,t,i),n._OrtReleaseSession=e=>(n._OrtReleaseSession=A.ra)(e),n._OrtGetInputOutputCount=(e,t,i)=>(n._OrtGetInputOutputCount=A.sa)(e,t,i),n._OrtGetInputName=(e,t)=>(n._OrtGetInputName=A.ta)(e,t),n._OrtGetOutputName=(e,t)=>(n._OrtGetOutputName=A.ua)(e,t),n._OrtFree=e=>(n._OrtFree=A.va)(e),n._OrtCreateTensor=(e,t,i,a,c,g)=>(n._OrtCreateTensor=A.wa)(e,t,i,a,c,g),n._OrtGetTensorData=(e,t,i,a,c)=>(n._OrtGetTensorData=A.xa)(e,t,i,a,c),n._OrtReleaseTensor=e=>(n._OrtReleaseTensor=A.ya)(e),n._OrtCreateRunOptions=(e,t,i,a)=>(n._OrtCreateRunOptions=A.za)(e,t,i,a),n._OrtAddRunConfigEntry=(e,t,i)=>(n._OrtAddRunConfigEntry=A.Aa)(e,t,i),n._OrtReleaseRunOptions=e=>(n._OrtReleaseRunOptions=A.Ba)(e),n._OrtCreateBinding=e=>(n._OrtCreateBinding=A.Ca)(e),n._OrtBindInput=(e,t,i)=>(n._OrtBindInput=A.Da)(e,t,i),n._OrtBindOutput=(e,t,i,a)=>(n._OrtBindOutput=A.Ea)(e,t,i,a),n._OrtClearBoundOutputs=e=>(n._OrtClearBoundOutputs=A.Fa)(e),n._OrtReleaseBinding=e=>(n._OrtReleaseBinding=A.Ga)(e),n._OrtRunWithBinding=(e,t,i,a,c)=>(n._OrtRunWithBinding=A.Ha)(e,t,i,a,c),n._OrtRun=(e,t,i,a,c,g,S,v)=>(n._OrtRun=A.Ia)(e,t,i,a,c,g,S,v),n._OrtEndProfiling=e=>(n._OrtEndProfiling=A.Ja)(e);var je=n._malloc=e=>(je=n._malloc=A.Ka)(e),ae=n._free=e=>(ae=n._free=A.La)(e),jt=e=>(jt=A.Ma)(e);n.__embind_initialize_bindings=()=>(n.__embind_initialize_bindings=A.Na)();var zt=()=>(zt=A.Pa)(),Gt=e=>(Gt=A.Qa)(e),Yt=e=>(Yt=A.Ra)(e);function Pn(){var e=A;e=Object.assign({},e);var t=a=>()=>a()>>>0,i=a=>c=>a(c)>>>0;return e.__errno_location=t(e.__errno_location),e.Ka=i(e.Ka),e.Ma=i(e.Ma),e.Pa=t(e.Pa),e.Ra=i(e.Ra),e}n.stackAlloc=Yt,n.stackSave=zt,n.stackRestore=Gt,n.UTF8ToString=Re,n.stringToUTF8=(e,t,i)=>We(e,R,t,i),n.lengthBytesUTF8=Fe;var ze;q=function e(){ze||Vt(),ze||(q=e)};function Vt(){if(!(0<ne)){for(;0<fe.length;)fe.shift()(n);if(!(0<ne||ze||(ze=!0,n.calledRun=!0,j))){for(;0<ve.length;)ve.shift()(n);for(u(n);0<re.length;)re.shift()(n)}}}return Vt(),r.ready}})();typeof Pr=="object"&&typeof ht=="object"?ht.exports=Ar:typeof define=="function"&&define.amd&&define([],()=>Ar)});var wt,Fn,yt,gt,et,xr,Wn,kn,Nn,Br,N,Te=U(()=>{"use strict";wt=Ir();Fn=wt,gt=!1,et=!1,xr=!1,Wn=()=>{try{return typeof SharedArrayBuffer>"u"?!1:(typeof MessageChannel<"u"&&new MessageChannel().port1.postMessage(new SharedArrayBuffer(1)),WebAssembly.validate(new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,2,1,0,5,4,1,3,1,1,10,11,1,9,0,65,0,254,16,2,0,26,11])))}catch{return!1}},kn=()=>{try{return WebAssembly.validate(new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,2,1,0,10,30,1,28,0,65,0,253,15,253,12,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,253,186,1,26,11]))}catch{return!1}},Nn=(o,r)=>o?r?"ort-wasm-simd-threaded.wasm":"ort-wasm-simd.wasm":r?"ort-wasm-threaded.wasm":"ort-wasm.wasm",Br=async o=>{if(gt)return Promise.resolve();if(et)throw new Error("multiple calls to 'initializeWebAssembly()' detected.");if(xr)throw new Error("previous call to 'initializeWebAssembly()' failed.");et=!0;let r=o.initTimeout,n=o.numThreads,u=o.simd,s=n>1&&Wn(),p=u&&kn(),f=o.wasmPaths,m=typeof f=="string"?f:void 0,h=Nn(p,s),l=typeof f=="object"?f[h]:void 0,y=!1,b=[];if(r>0&&b.push(new Promise(w=>{setTimeout(()=>{y=!0,w()},r)})),b.push(new Promise((w,E)=>{(s?Fn:wt)({locateFile:(M,B)=>M.endsWith(".wasm")?l||(m??B)+h:B+M}).then(M=>{et=!1,gt=!0,yt=M,w()},M=>{et=!1,xr=!0,E(M)})})),await Promise.race(b),y)throw new Error(`WebAssembly backend initializing failed due to timeout: ${r}ms`)},N=()=>{if(gt&&yt)return yt;throw new Error("WebAssembly is not initialized yet.")}});var $,xe,k,tt=U(()=>{"use strict";Te();$=(o,r)=>{let n=N(),u=n.lengthBytesUTF8(o)+1,s=n._malloc(u);return n.stringToUTF8(o,s,u),r.push(s),s},xe=(o,r,n,u)=>{if(typeof o=="object"&&o!==null){if(n.has(o))throw new Error("Circular reference in options");n.add(o)}Object.entries(o).forEach(([s,p])=>{let f=r?r+s:s;if(typeof p=="object")xe(p,f+".",n,u);else if(typeof p=="string"||typeof p=="number")u(f,p.toString());else if(typeof p=="boolean")u(f,p?"1":"0");else throw new Error(`Can't handle extra config type: ${typeof p}`)})},k=o=>{let r=N(),n=r.stackSave();try{let u=r.stackAlloc(8);r._OrtGetLastError(u,u+4);let s=r.HEAP32[u/4],p=r.HEAPU32[u/4+1],f=p?r.UTF8ToString(p):"";throw new Error(`${o} ERROR_CODE: ${s}, ERROR_MESSAGE: ${f}`)}finally{r.stackRestore(n)}}});var _r,Cr=U(()=>{"use strict";Te();tt();_r=o=>{let r=N(),n=0,u=[],s=o||{};try{if(o?.logSeverityLevel===void 0)s.logSeverityLevel=2;else if(typeof o.logSeverityLevel!="number"||!Number.isInteger(o.logSeverityLevel)||o.logSeverityLevel<0||o.logSeverityLevel>4)throw new Error(`log serverity level is not valid: ${o.logSeverityLevel}`);if(o?.logVerbosityLevel===void 0)s.logVerbosityLevel=0;else if(typeof o.logVerbosityLevel!="number"||!Number.isInteger(o.logVerbosityLevel))throw new Error(`log verbosity level is not valid: ${o.logVerbosityLevel}`);o?.terminate===void 0&&(s.terminate=!1);let p=0;return o?.tag!==void 0&&(p=$(o.tag,u)),n=r._OrtCreateRunOptions(s.logSeverityLevel,s.logVerbosityLevel,!!s.terminate,p),n===0&&k("Can't create run options."),o?.extra!==void 0&&xe(o.extra,"",new WeakSet,(f,m)=>{let h=$(f,u),l=$(m,u);r._OrtAddRunConfigEntry(n,h,l)!==0&&k(`Can't set a run config entry: ${f} - ${m}.`)}),[n,u]}catch(p){throw n!==0&&r._OrtReleaseRunOptions(n),u.forEach(f=>r._free(f)),p}}});var $n,Hn,jn,zn,Dr,Ur=U(()=>{"use strict";Te();tt();$n=o=>{switch(o){case"disabled":return 0;case"basic":return 1;case"extended":return 2;case"all":return 99;default:throw new Error(`unsupported graph optimization level: ${o}`)}},Hn=o=>{switch(o){case"sequential":return 0;case"parallel":return 1;default:throw new Error(`unsupported execution mode: ${o}`)}},jn=o=>{o.extra||(o.extra={}),o.extra.session||(o.extra.session={});let r=o.extra.session;r.use_ort_model_bytes_directly||(r.use_ort_model_bytes_directly="1"),o.executionProviders&&o.executionProviders.some(n=>(typeof n=="string"?n:n.name)==="webgpu")&&(o.enableMemPattern=!1)},zn=(o,r,n)=>{for(let u of r){let s=typeof u=="string"?u:u.name;switch(s){case"xnnpack":s="XNNPACK";break;case"webnn":if(s="WEBNN",typeof u!="string"){let f=u;if(f?.deviceType){let m=$("deviceType",n),h=$(f.deviceType,n);N()._OrtAddSessionConfigEntry(o,m,h)!==0&&k(`Can't set a session config entry: 'deviceType' - ${f.deviceType}.`)}if(f?.numThreads){let m=f.numThreads;(typeof m!="number"||!Number.isInteger(m)||m<0)&&(m=0);let h=$("numThreads",n),l=$(m.toString(),n);N()._OrtAddSessionConfigEntry(o,h,l)!==0&&k(`Can't set a session config entry: 'numThreads' - ${f.numThreads}.`)}if(f?.powerPreference){let m=$("powerPreference",n),h=$(f.powerPreference,n);N()._OrtAddSessionConfigEntry(o,m,h)!==0&&k(`Can't set a session config entry: 'powerPreference' - ${f.powerPreference}.`)}}break;case"webgpu":if(s="JS",typeof u!="string"){let f=u;if(f?.preferredLayout){if(f.preferredLayout!=="NCHW"&&f.preferredLayout!=="NHWC")throw new Error(`preferredLayout must be either 'NCHW' or 'NHWC': ${f.preferredLayout}`);let m=$("preferredLayout",n),h=$(f.preferredLayout,n);N()._OrtAddSessionConfigEntry(o,m,h)!==0&&k(`Can't set a session config entry: 'preferredLayout' - ${f.preferredLayout}.`)}}break;case"wasm":case"cpu":continue;default:throw new Error(`not supported execution provider: ${s}`)}let p=$(s,n);N()._OrtAppendExecutionProvider(o,p)!==0&&k(`Can't append execution provider: ${s}.`)}},Dr=o=>{let r=N(),n=0,u=[],s=o||{};jn(s);try{let p=$n(s.graphOptimizationLevel??"all"),f=Hn(s.executionMode??"sequential"),m=typeof s.logId=="string"?$(s.logId,u):0,h=s.logSeverityLevel??2;if(!Number.isInteger(h)||h<0||h>4)throw new Error(`log serverity level is not valid: ${h}`);let l=s.logVerbosityLevel??0;if(!Number.isInteger(l)||l<0||l>4)throw new Error(`log verbosity level is not valid: ${l}`);let y=typeof s.optimizedModelFilePath=="string"?$(s.optimizedModelFilePath,u):0;if(n=r._OrtCreateSessionOptions(p,!!s.enableCpuMemArena,!!s.enableMemPattern,f,!!s.enableProfiling,0,m,h,l,y),n===0&&k("Can't create session options."),s.executionProviders&&zn(n,s.executionProviders,u),s.freeDimensionOverrides)for(let[b,w]of Object.entries(s.freeDimensionOverrides)){if(typeof b!="string")throw new Error(`free dimension override name must be a string: ${b}`);if(typeof w!="number"||!Number.isInteger(w)||w<0)throw new Error(`free dimension override value must be a non-negative integer: ${w}`);let E=$(b,u);r._OrtAddFreeDimensionOverride(n,E,w)!==0&&k(`Can't set a free dimension override: ${b} - ${w}.`)}return s.extra!==void 0&&xe(s.extra,"",new WeakSet,(b,w)=>{let E=$(b,u),x=$(w,u);r._OrtAddSessionConfigEntry(n,E,x)!==0&&k(`Can't set a session config entry: ${b} - ${w}.`)}),[n,u]}catch(p){throw n!==0&&r._OrtReleaseSessionOptions(n),u.forEach(f=>r._free(f)),p}}});var bt,Mr,vt,Lr,Rr,rt,Fr,Et=U(()=>{"use strict";bt=o=>{switch(o){case"int8":return 3;case"uint8":return 2;case"bool":return 9;case"int16":return 5;case"uint16":return 4;case"int32":return 6;case"uint32":return 12;case"float16":return 10;case"float32":return 1;case"float64":return 11;case"string":return 8;case"int64":return 7;case"uint64":return 13;default:throw new Error(`unsupported data type: ${o}`)}},Mr=o=>{switch(o){case 3:return"int8";case 2:return"uint8";case 9:return"bool";case 5:return"int16";case 4:return"uint16";case 6:return"int32";case 12:return"uint32";case 10:return"float16";case 1:return"float32";case 11:return"float64";case 8:return"string";case 7:return"int64";case 13:return"uint64";default:throw new Error(`unsupported data type: ${o}`)}},vt=o=>[void 0,4,1,1,2,2,4,8,void 0,1,2,8,4,8,void 0,void 0,void 0][o],Lr=o=>{switch(o){case"float16":return Uint16Array;case"float32":return Float32Array;case"uint8":return Uint8Array;case"int8":return Int8Array;case"uint16":return Uint16Array;case"int16":return Int16Array;case"int32":return Int32Array;case"bool":return Uint8Array;case"float64":return Float64Array;case"uint32":return Uint32Array;case"int64":return BigInt64Array;case"uint64":return BigUint64Array;default:throw new Error(`unsupported type: ${o}`)}},Rr=o=>{switch(o){case"verbose":return 0;case"info":return 1;case"warning":return 2;case"error":return 3;case"fatal":return 4;default:throw new Error(`unsupported logging level: ${o}`)}},rt=o=>o==="float32"||o==="int32"||o==="int64"||o==="bool"||o==="float16"||o==="uint32",Fr=o=>{switch(o){case"none":return 0;case"cpu":return 1;case"cpu-pinned":return 2;case"texture":return 3;case"gpu-buffer":return 4;default:throw new Error(`unsupported data location: ${o}`)}}});var Gn,kr,Nr,Be,Yn,Tt,$r,Hr,Wr,jr,zr,Gr=U(()=>{"use strict";Cr();Ur();Et();Te();tt();Gn=(o,r)=>{N()._OrtInit(o,r)!==0&&k("Can't initialize onnxruntime.")},kr=async o=>{Gn(o.wasm.numThreads,Rr(o.logLevel))},Nr=async(o,r)=>{},Be=new Map,Yn=o=>{let r=N(),n=r.stackSave();try{let u=r.stackAlloc(8);return r._OrtGetInputOutputCount(o,u,u+4)!==0&&k("Can't get session input/output count."),[r.HEAP32[u/4],r.HEAP32[u/4+1]]}finally{r.stackRestore(n)}},Tt=o=>{let r=N(),n=r._malloc(o.byteLength);if(n===0)throw new Error(`Can't create a session. failed to allocate a buffer of size ${o.byteLength}.`);return r.HEAPU8.set(o,n),[n,o.byteLength]},$r=(o,r)=>{let n,u,s=N();Array.isArray(o)?[n,u]=o:o.buffer===s.HEAPU8.buffer?[n,u]=[o.byteOffset,o.byteLength]:[n,u]=Tt(o);let p=0,f=0,m=0,h=[],l=[],y=[];try{[f,h]=Dr(r),p=s._OrtCreateSession(n,u,f),p===0&&k("Can't create a session.");let[b,w]=Yn(p),E=[],x=[],I=[];for(let B=0;B<b;B++){let L=s._OrtGetInputName(p,B);L===0&&k("Can't get an input name."),l.push(L),E.push(s.UTF8ToString(L))}for(let B=0;B<w;B++){let L=s._OrtGetOutputName(p,B);L===0&&k("Can't get an output name."),y.push(L);let j=s.UTF8ToString(L);x.push(j)}let M=null;return Be.set(p,[p,l,y,M]),[p,E,x]}catch(b){throw l.forEach(w=>s._OrtFree(w)),y.forEach(w=>s._OrtFree(w)),m!==0&&s._OrtReleaseBinding(m),p!==0&&s._OrtReleaseSession(p),b}finally{s._free(n),f!==0&&s._OrtReleaseSessionOptions(f),h.forEach(b=>s._free(b))}},Hr=o=>{let r=N(),n=Be.get(o);if(!n)throw new Error(`cannot release session. invalid session id: ${o}`);let[u,s,p,f]=n;f&&r._OrtReleaseBinding(f.handle),r.jsepUnregisterBuffers?.(o),s.forEach(m=>r._OrtFree(m)),p.forEach(m=>r._OrtFree(m)),r._OrtReleaseSession(u),Be.delete(o)},Wr=(o,r,n,u,s)=>{if(!o){r.push(0);return}let p=N(),f=o[0],m=o[1],h=o[3],l,y;if(f==="string"&&h==="gpu-buffer")throw new Error("String tensor is not supported on GPU.");if(h==="gpu-buffer"){let E=o[2].gpuBuffer,x=vt(bt(f));y=m.reduce((I,M)=>I*M,1)*x,l=p.jsepRegisterBuffer(u,s,E,y)}else{let E=o[2];if(Array.isArray(E)){y=4*E.length,l=p._malloc(y),n.push(l);let x=l/4;for(let I=0;I<E.length;I++){if(typeof E[I]!="string")throw new TypeError(`tensor data at index ${I} is not a string`);p.HEAPU32[x++]=$(E[I],n)}}else y=E.byteLength,l=p._malloc(y),n.push(l),p.HEAPU8.set(new Uint8Array(E.buffer,E.byteOffset,y),l)}let b=p.stackSave(),w=p.stackAlloc(4*m.length);try{let E=w/4;m.forEach(I=>p.HEAP32[E++]=I);let x=p._OrtCreateTensor(bt(f),l,y,w,m.length,Fr(h));x===0&&k(`Can't create tensor for input/output. session=${u}, index=${s}.`),r.push(x)}finally{p.stackRestore(b)}},jr=async(o,r,n,u,s,p)=>{let f=N(),m=Be.get(o);if(!m)throw new Error(`cannot run inference. invalid session id: ${o}`);let[h,l,y,b]=m,w=r.length,E=u.length,x=0,I=[],M=[],B=[],L=[],j=f.stackSave(),z=f.stackAlloc(w*4),R=f.stackAlloc(w*4),oe=f.stackAlloc(E*4),pe=f.stackAlloc(E*4);try{[x,I]=_r(p);for(let C=0;C<w;C++)Wr(n[C],M,L,o,r[C]);for(let C=0;C<E;C++)Wr(s[C],B,L,o,w+u[C]);let T=z/4,_=R/4,_e=oe/4,Ce=pe/4;for(let C=0;C<w;C++)f.HEAPU32[T++]=M[C],f.HEAPU32[_++]=l[r[C]];for(let C=0;C<E;C++)f.HEAPU32[_e++]=B[C],f.HEAPU32[Ce++]=y[u[C]];let Se;Se=await f._OrtRun(h,R,z,w,pe,E,oe,x),Se!==0&&k("failed to call OrtRun().");let ue=[];for(let C=0;C<E;C++){let fe=f.HEAPU32[oe/4+C];if(fe===B[C]){ue.push(s[C]);continue}let ve=f.stackSave(),re=f.stackAlloc(4*4),ne=!1,G,q=0;try{f._OrtGetTensorData(fe,re,re+4,re+8,re+12)!==0&&k(`Can't access output tensor data on index ${C}.`);let me=re/4,ce=f.HEAPU32[me++];q=f.HEAPU32[me++];let Oe=f.HEAPU32[me++],Ue=f.HEAPU32[me++],he=[];for(let X=0;X<Ue;X++)he.push(f.HEAPU32[Oe/4+X]);f._OrtFree(Oe);let le=he.reduce((X,Y)=>X*Y,1);G=Mr(ce);let Me=b?.outputPreferredLocations[u[C]];if(G==="string"){if(Me==="gpu-buffer")throw new Error("String tensor is not supported on GPU.");let X=[],Y=q/4;for(let Ae=0;Ae<le;Ae++){let Pe=f.HEAPU32[Y++],Le=Ae===le-1?void 0:f.HEAPU32[Y]-Pe;X.push(f.UTF8ToString(Pe,Le))}ue.push([G,he,X,"cpu"])}else if(Me==="gpu-buffer"&&le>0){let X=f.jsepGetBuffer(q),Y=vt(ce);if(Y===void 0||!rt(G))throw new Error(`Unsupported data type: ${G}`);ne=!0,ue.push([G,he,{gpuBuffer:X,download:f.jsepCreateDownloader(X,le*Y,G),dispose:()=>{f._OrtReleaseTensor(fe)}},"gpu-buffer"])}else{let X=Lr(G),Y=new X(le);new Uint8Array(Y.buffer,Y.byteOffset,Y.byteLength).set(f.HEAPU8.subarray(q,q+Y.byteLength)),ue.push([G,he,Y,"cpu"])}}finally{f.stackRestore(ve),G==="string"&&q&&f._free(q),ne||f._OrtReleaseTensor(fe)}}return b&&f._OrtClearBoundOutputs(b.handle),ue}finally{f.stackRestore(j),M.forEach(T=>f._OrtReleaseTensor(T)),B.forEach(T=>f._OrtReleaseTensor(T)),L.forEach(T=>f._free(T)),x!==0&&f._OrtReleaseRunOptions(x),I.forEach(T=>f._free(T))}},zr=o=>{let r=N(),n=Be.get(o);if(!n)throw new Error("invalid session id");let u=n[0],s=r._OrtEndProfiling(u);s===0&&k("Can't get an profile file name."),r._OrtFree(s)}});var St,Yr,Vr,oi,qr,Xr,Jr,Zr,Kr,Qr,en,Ot=U(()=>{"use strict";be();Gr();Te();St=!1,Yr=!1,Vr=!1,oi=typeof document<"u"?document?.currentScript?.src:void 0,qr=async()=>{if(!Yr){if(St)throw new Error("multiple calls to 'initWasm()' detected.");if(Vr)throw new Error("previous call to 'initWasm()' failed.");St=!0;try{await Br(H.wasm),await kr(H),Yr=!0}catch(o){throw Vr=!0,o}finally{St=!1}}},Xr=async o=>{await Nr(H,o)},Jr=async o=>Tt(o),Zr=async(o,r)=>$r(o,r),Kr=async o=>{Hr(o)},Qr=async(o,r,n,u,s,p)=>jr(o,r,n,u,s,p),en=async o=>{zr(o)}});var tn,qn,nt,rn=U(()=>{"use strict";be();Ot();Et();tn=(o,r)=>{switch(o.location){case"cpu":return[o.type,o.dims,o.data,"cpu"];case"gpu-buffer":return[o.type,o.dims,{gpuBuffer:o.gpuBuffer},"gpu-buffer"];default:throw new Error(`invalid data location: ${o.location} for ${r()}`)}},qn=o=>{switch(o[3]){case"cpu":return new V(o[0],o[2],o[1]);case"gpu-buffer":{let r=o[0];if(!rt(r))throw new Error(`not supported data type: ${r} for deserializing GPU tensor`);let{gpuBuffer:n,download:u,dispose:s}=o[2];return V.fromGpuBuffer(n,{dataType:r,dims:o[1],download:u,dispose:s})}default:throw new Error(`invalid data location: ${o[3]}`)}},nt=class{async fetchModelAndCopyToWasmMemory(r){let n=await fetch(r);if(n.status!==200)throw new Error(`failed to load model: ${r}`);let u=await n.arrayBuffer();return Jr(new Uint8Array(u))}async loadModel(r,n){let u;typeof r=="string"?typeof process<"u"&&process.versions&&process.versions.node?u=await(void 0)(r):u=await this.fetchModelAndCopyToWasmMemory(r):u=r,[this.sessionId,this.inputNames,this.outputNames]=await Zr(u,n)}async dispose(){return Kr(this.sessionId)}async run(r,n,u){let s=[],p=[];Object.entries(r).forEach(w=>{let E=w[0],x=w[1],I=this.inputNames.indexOf(E);if(I===-1)throw new Error(`invalid input '${E}'`);s.push(x),p.push(I)});let f=[],m=[];Object.entries(n).forEach(w=>{let E=w[0],x=w[1],I=this.outputNames.indexOf(E);if(I===-1)throw new Error(`invalid output '${E}'`);f.push(x),m.push(I)});let h=s.map((w,E)=>tn(w,()=>`input "${this.inputNames[p[E]]}"`)),l=f.map((w,E)=>w?tn(w,()=>`output "${this.outputNames[m[E]]}"`):null),y=await Qr(this.sessionId,p,h,m,l,u),b={};for(let w=0;w<y.length;w++)b[this.outputNames[m[w]]]=f[w]??qn(y[w]);return b}startProfiling(){}endProfiling(){en(this.sessionId)}}});var Xn,ot,nn=U(()=>{"use strict";be();Ot();rn();Xn=()=>{if((typeof H.wasm.initTimeout!="number"||H.wasm.initTimeout<0)&&(H.wasm.initTimeout=0),typeof H.wasm.simd!="boolean"&&(H.wasm.simd=!0),typeof H.wasm.proxy!="boolean"&&(H.wasm.proxy=!1),typeof H.wasm.numThreads!="number"||!Number.isInteger(H.wasm.numThreads)||H.wasm.numThreads<=0){let o=typeof navigator>"u"?(void 0)().length:navigator.hardwareConcurrency;H.wasm.numThreads=Math.min(4,Math.ceil((o||1)/2))}},ot=class{async init(r){Xn(),await qr(),await Xr(r)}async createInferenceSessionHandler(r,n){let u=new nt;return await u.loadModel(r,n),Promise.resolve(u)}}});var on={};Ge(on,{wasmBackend:()=>Jn});var Jn,an=U(()=>{"use strict";nn();Jn=new ot});be();be();be();var vr="1.17.0";var Si=mt;{let o=(an(),lt(on)).wasmBackend;we("cpu",o,10),we("wasm",o,10),we("xnnpack",o,9),we("webnn",o,9)}Object.defineProperty(H.versions,"web",{value:vr,enumerable:!0});export{Dn as InferenceSession,V as Tensor,Mn as TrainingSession,Si as default,H as env,we as registerBackend};
//# sourceMappingURL=ort.wasm-core.min.js.map
